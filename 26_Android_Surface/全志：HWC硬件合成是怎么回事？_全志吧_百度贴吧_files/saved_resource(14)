_.Module.define({path:"tbmall/component/util",sub:{_propCategoryMap:{101:"\u53D1\u8D34\u6C14\u6CE1",102:"",103:"\u4E2A\u6027\u6C34\u5370",104:"\u70AB\u5F69\u5B57\u4F53",105:"",106:"",107:"\u9B54\u6CD5\u5F39",108:"\u8865\u7B7E\u795E\u5668",109:"\u52A8\u6001\u5934\u50CF",110:"\u5934\u50CF\u8FB9\u6846",111:"",112:"\u4E2A\u6027\u94ED\u724C",113:"\u540D\u7247\u80CC\u666F",114:"\u94ED\u724C\u91CD\u94F8\u5361",115:"",116:"\u8D34\u6761\u5361",117:"\u633D\u5C0A\u5361"},_freeUseMap:{1070001:12,1070002:12,1080001:8},_badgeMap:{1:"\u8D34\u5427\u4F1A\u5458",2:"\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"},initial:function(){},badgeNameMap:function(e){var a=parseInt(e);return a>105e4&&(a-=105e4),this._badgeMap[a]},getFreeUseCount:function(e){return this._freeUseMap[e]},getMaxLevel:function(e){var a=0,t=(new Date).getTime(),n=e||PageData.user.Parr_props;if(!n||!n.level)return 0;var r=n.level;return 1e3*r.end_time>t&&parseInt(r.props_id,10)>a&&(a=parseInt(r.props_id,10)),a},convertNumber:function(e){return e>99999999?Math.round(e/1e8,2)+"\u4EBF":e>99999?Math.round(e/1e4,2)+"\u4E07":e},formatDate:function(e){function a(e){return e>9?e:"0"+e.toString()}var t=new Date(1e3*e);return t.getFullYear()+"\u5E74"+(t.getMonth()+1)+"\u6708"+t.getDate()+"\u65E5 "+a(t.getHours())+":"+a(t.getMinutes())},hasOwnProp:function(e,a){return PageData.props[e]&&PageData.props[e][a]&&1e3*PageData.props[e][a].end_time>Env.server_time},convertToDay:function(e){return Math.ceil(e/86400)+"\u5929"},getCategoryName:function(e){return this._propCategoryMap[e]},getFreeInfo:function(e){var a=this,t='<div class="free_info">';return"1080002"==e.props_id?(t+='<span  title="'+a.badgeNameMap(2)+'" >',t+='<a class="j_tbmall_join_vip_btn strong_txt level2"><span class="icon"></span>\u4E00\u6B21\u5145\u503C12\u4E2A\u6708\uFF0C</a>\u9001\u4E09\u5F20</span>'):1==e.props_type&&a.getFreeUseCount(e.props_id)?(t+='<span  title="'+a.badgeNameMap(2)+'" >',t+='<a class="j_tbmall_join_vip_btn strong_txt level2"><span class="icon"></span>\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</a>\u514D\u8D39\u4F7F\u7528',t+='<span class="free_use_count">'+a.getFreeUseCount(e.props_id)+"</span>\u4E2A</span>"):1!=e.props_type&&(t+='<span  title="'+a.badgeNameMap(e.free_user_level)+'" >',t+='<a class="j_tbmall_join_vip_btn strong_txt level'+e.free_user_level+'"><span class="icon"></span>\u5F00\u901A'+(2==e.free_user_level?"\u8D85\u7EA7":"")+"\u4F1A\u5458</a>\u514D\u8D39\u4F7F\u7528</span>"),t+="</div>"},hasUsedProp:function(e,a){return PageData.props[e]&&!!PageData.props[e][a]&&!!parseInt(PageData.props[e][a].open_status,10)},hasBadge:function(){return PageData.props.level&&PageData.props.level.prop_id&&1e3*PageData.props.level.end_time>Env.server_time},shouldHaveProp:function(e){return e>0&&this.hasBadge()&&PageData.props.level.prop_id>=e},getBuyInfo:function(e){var a,t,n=this,r="",s=e.props_category,p=e.props_id,o=e.free_user_level,_=n.hasOwnProp(s,p),i=n.hasUsedProp(s,p),u=n.shouldHaveProp(o);return _?"1"===e.is_default_used&&(i?(t="\u53D6\u6D88\u4F7F\u7528",a="j_cancle_use"):(t="\u4F7F\u7528",a="j_use"),r+=['<a href="#" class="ui_btn ui_btn_sub_s '+a+'">',"<span><em>"+t+"</em></span>","</a>"].join("")):(u?(a="j_get_button1",t="\u9886\u53D6"):(a="j_buy_button1",t="\u5151&nbsp;&nbsp;\u6362"),r+=['<a class="ui_btn ui_btn_sub_s '+a+'">',"<span><em>"+t+"</em></span>","</a>"].join("")),r}}});_.Module.define({path:"tbmall/widget/ContSignCard",requires:["tbmall/component/util","tbmall/component/Dialog","common/widget/JoinVipDialog"],sub:{_card_count:0,_tpl:'<div class="header">\u70B9\u51FB\u6211\u5173\u6CE8\u7684\u5427\u4F7F\u7528\u8FDE\u7EED\u7B7E\u5230\u5361\uFF08<span class="condition">\u6CE8\uFF1A\u4F7F\u7528\u6761\u4EF6\u4E3A\u7D2F\u8BA1\u7B7E\u5230\u5929\u6570\u2265100\u5929\uFF0C\u4EC5\u4F1A\u5458\u53EF\u4EE5\u4F7F\u7528</span>\uFF09\uFF1A</div><div id="j_signable_list" class="signable_list"><img class="loading" src="//tb1.bdstatic.com/tb/static-tbmall/img/loading.gif"></div><div class="bottom_info"><div class="my_cont_card">\u6211\u6709<span class="j_card_count orange_txt">0</span>\u5F20<span class="orange_txt">\u8FDE\u7EED\u7B7E\u5230\u5361</span></div><p class="">\u8FDE\u7EED\u7B7E\u5230\u5361\u5C06\u628A\u9009\u4E2D\u5427\u6240\u6709\u7684\u7B7E\u5230\u5929\u6570\u8FDE\u7EED\u5728\u4E00\u8D77\uFF01</p> </div> <div class="free_info"><span title="\u8D85\u7EA7\u8D34\u5427\u4F1A\u5458"><a class="j_tbmall_join_vip_btn strong_txt level2"><span class="icon"></span>\u4E00\u6B21\u5145\u503C12\u4E2A\u6708\uFF0C</a>\u9001\u4E09\u5F20</span> </div>',initial:function(){var t=this;return t.util=t.use("tbmall/component/util"),t.mdialog=t.use("tbmall/component/Dialog"),t.vip=t.use("common/widget/JoinVipDialog"),PageData.user.is_login?(t.build(),t.loadSignableList(),t.bindEvent(),void 0):(_.Module.use("common/widget/LoginDialog"),void 0)},showMemberOnly:function(){var t=this,e=['<div id="sign_tip_forNoMember" class="sign_tip_forNoMember">',"<p><span>\u8FDE\u7EED\u7B7E\u5230\u5361</span>\u662F\u4F1A\u5458\u4E13\u5C5E\u9053\u5177,\u6210\u4E3A\u4F1A\u5458\u5373\u53EF\u4F7F\u7528!</p>",'<a class="ui_btn ui_btn_m j_openMember" href="#"><span><em>\u9A6C\u4E0A\u5F00\u901A</em></span></a>','<p><a class="j_tbmall_join_vip_btn level2_icon" href="#">\u5145\u6EE112\u4E2A\u6708\u8D85\u7EA7\u4F1A\u5458</a>\u9001\u4E09\u5F20</p>',"</div>"].join(""),i=new $.dialog({html:e,title:"\u63D0\u793A",width:430,height:100});$("#sign_tip_forNoMember").delegate(".j_openMember","click",function(e){e.preventDefault(),i.close(),t.vip.getMemberDialog()}),$("#sign_tip_forNoMember").delegate(".j_tbmall_join_vip_btn","click",function(e){e.preventDefault(),i.close(),t.vip.getMemberDialog()})},build:function(){var t=this;this._dialog=new $.dialog({title:"\u4F7F\u7528\u8FDE\u7EED\u7B7E\u5230\u5361",html:t._tpl,width:662,holderClassName:"cont_sign_dialog",fixed:!1}),this._listdom=this._dialog.element.find("#j_signable_list")},loadSignableList:function(){var t=this,e="";$.tb.get("/tbmall/get/getContSignableList",function(i){if(i&&0==i.no){var a=i.data.list;if(a.length){for(var n=0,l=a.length;l>n;n++)e+='<a href="/f?kw='+encodeURIComponent(a[n].forum_name)+'&ie=utf-8" target="_blank" data-fid="'+a[n].forum_id+'" class="signable_ba j_signable_ba">'+$.tb.subByte(a[n].forum_name,11)+'<span class="forum_level lv'+a[n].level_id+'"></span></a> ';t._listdom.html(""),_.Module.use("common/widget/ScrollPanel",[{content:e,container:t._listdom,height:210}])}else e='<div class="no_signable_tip gray_txt">\u6CA1\u6709\u68C0\u6D4B\u5230\u4F60\u6709\u7D2F\u8BA1\u7B7E\u5230\u2265100\u5929\uFF0C\u6216\u8005\u65AD\u7B7E\u7684\u5427\uFF0C\u8BF7\u6838\u5B9E\u540E\u5237\u65B0\u9875\u9762\u3002</div>',t._dialog.element.find("#j_signable_list").height(280).html(e);t._card_count=i.data.card_count,t._dialog.element.find(".j_card_count").text(i.data.card_count)}else e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\uFF0C\u8BF7\u5173\u95ED\u7A97\u53E3\u91CD\u65B0\u52A0\u8F7D",t._dialog.element.find("#j_signable_list").html(e)})},bindEvent:function(){var t=this;this._dialog.element.on("click",".j_signable_ba",function(e){return t.util.getMaxLevel()?($(this).hasClass("signed")||(e.preventDefault(),t.showBubble($(this))),void 0):(e.preventDefault(),t._dialog.close(),t.showMemberOnly(),void 0)}),this._dialog.bind("onclose",function(){t._bubble&&t._bubble.closeBubble()})},showBubble:function(t){var e=this;if(!e._isAjaxing){var i=t.data("fid"),a=t.offset(),n={arrow_dir:"up",bubble_css:{top:a.top+37,left:a.left-39,width:172,height:69,zIndex:6e4},arrow_pos:{left:87},wrap:$("body"),closeBtn:!0},l='<div class="card_bubble_content"><span>\u6CA1\u6709<span class="blue_txt">\u8FDE\u7EED\u7B7E\u5230\u5361</span></span><div><a href="/tbmall/propslist?category=108" target="_blank" class="ui_btn ui_btn_sub_s j_buy_card"><span><em>\u7ACB\u5373\u8D2D\u4E70</em></span></a> </div></div>',s='<div class="card_bubble_content"><span>\u9700\u8981\u6D88\u8017<span class="blue_txt">1\u5F20\u8FDE\u7EED\u7B7E\u5230\u5361</span></span><div><a class="ui_btn ui_btn_sub_s j_use_card"><span><em>\u786E \u5B9A</em></span></a> </div></div>',o='<div class="card_bubble_content"><span class="blue_txt">\u5DF2\u7ECF\u6210\u529F\u4F7F\u7528\u8FDE\u7EED\u7B7E\u5230\u5361,\u70B9\u51FB\u5427\u540D\u67E5\u770B</span></div>',_='<div class="card_bubble_content"><span>\u8FDE\u7EED\u7B7E\u5230\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5~</span></div>';e._bubble&&e._bubble.closeBubble(),n.content=e._card_count<1?l:s,e._bubble=new UiBubbleTipBase(n),e._bubble.j_bubble.one("click",".j_buy_card",function(){e._bubble.closeBubble()}).one("click",".j_use_card",function(a){a.preventDefault(),e._isAjaxing=!0,e._bubble.setContent('<div class="card_bubble_content"><img src="//tb1.bdstatic.com/tb/static-tbmall/img/loading.gif">\u6B63\u5728\u8FDE\u7EED\u7B7E\u5230...</div>'),$.tb.post("/tbmall/post/useContSignCard",{forum_id:i,tbs:PageData.tbs},function(i){e._isAjaxing=!1,i&&0==i.no?(e._card_count--,e._card_count=Math.max(0,e._card_count),e._dialog.element.find(".j_card_count").text(e._card_count),e._bubble.setContent(o),t.addClass("signed")):e._bubble.setContent(_)})}),e._bubble.showBubble()}}}});_.Module.define({path:"common/widget/UserHead",sub:{initial:function(){this.initOptions()},initOptions:function(){this.options={gif:["1100001","1100002","1100003","1100013","1100015","1100016","1100017","1100019","1100133","1100135"],filter:[]}},getImgFormat:function(t){var r="png";return-1!=$.inArray(t,this.options.gif)&&(r="gif"),r},getHeadUrl:function(t){var r=t.mParr_props&&t.mParr_props.portrait||"",i="";return i=r.end_time>Env.server_time/1e3?r.url:"https:"===$.tb.location.getProtocol()?"https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/"+t.portrait:"https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/"+t.portrait},getHeadFrameStyle:function(t,r){var i=t.mParr_props&&t.mParr_props.avatarframe||"",e="",o=null,s={hasFrame:!1,stylestr:""};return i.end_time>Env.server_time/1e3&&(e=i.props_id,o=["width:"+r+"px","height:"+r+"px","padding:10px","background:url(/tb/static-common/img/props/"+r+"/"+e+"."+this.getImgFormat(e)+") no-repeat","border:none","left:-6px","top:-6px"],s={hasFrame:!0,stylestr:o.join(";")}),s}}});_.Module.define({path:"props/component/Guide",sub:{initial:function(){},initMagicGuide:function(){var i=$.cookie("PROPS_MAGIC_GUIDE");i||($.cookie("PROPS_MAGIC_GUIDE","true",{expires:30}),this.showMagicGuide())},showMagicGuide:function(i){this.propsId=i,this.builGuideUI(),this.buildGuideEvents(),this.initGuideFlash()},initPreviewUI:function(){this.builGuideUI(),this.buildGuideEvents()},builGuideUI:function(){this.$mask=new $.modal({show:!0});var i=$('<div class="guide_wrap"></div>'),e=$('<div class="guide_content"></div>'),s=$('<a href="#" class="guide_close"></a>');i.append(e).append(s),$("body").append(i),i.css({"z-index":$.getzIndex()}),this.$guideWrap=i,this.$guideContent=e,this.$guideClose=s},buildGuideEvents:function(){var i=this;this.$mask.bind("click",function(){i.closeGuide()}),this.$guideClose.bind("click",function(){return i.closeGuide(),!1})},closeGuide:function(){this.$guideWrap.remove(),this.$mask.remove()},initGuideFlash:function(){this.buildFlashUI(),this.buildFlashEvents()},buildFlashUI:function(){this.$guideWrap.addClass("guide_wrap_magic")},buildFlashEvents:function(){var i=this,e={};e.finishPlay=function(){i.closeGuide()},window.MagicProps=e}}});_.Module.define({path:"tbmall/component/UseController",requires:["tbmall/component/NetProxy","tbmall/component/Dialog","tbmall/component/util"],sub:{buy_number:0,initial:function(){this.netProxy=this.use("tbmall/component/NetProxy"),this.dialog=this.use("tbmall/component/Dialog"),this.util=this.use("tbmall/component/util")},doUse:function(a,e){var t;$.isNumeric(a)?t=a:(this.wrap=a,t=e.props_id);var o=this;$.stats.track(t,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u70B9\u51FB\u4F7F\u7528"),o.netProxy.useProp(t,function(a){var e="";if(0==a.no)e="\u4F7F\u7528\u6210\u529F\uFF01";else switch(a.no){case 2270005:e="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:e="\u5DF2\u7ECF\u4E70\u8FC7\u5566";break;case 2270004:e="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u8D2D\u4E70\u672C\u52CB\u7AE0\uFF01";break;case 2270006:e="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u8D2D\u4E70";break;default:e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}o.wrap&&o.wrap.data("clicked",!1),o.dialog.info('<div class="tip">'+e+"</div>"),0==a.no&&o.dialog.bind("onInfoClose",function(){$.tb.location.reload()})})},cancelUse:function(a,e){var t;$.isNumeric(a)?t=a:(this.wrap=a,t=e.props_id);var o=this;$.stats.track(t,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u53D6\u6D88\u4F7F\u7528"),o.netProxy.cancelProp(t,function(a){var e="";if(0==a.no)e="\u53D6\u6D88\u4F7F\u7528\u6210\u529F\uFF01";else switch(a.no){case 2270005:e="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:e="\u5DF2\u7ECF\u4E70\u8FC7\u5566";break;case 2270004:e="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u8D2D\u4E70\u672C\u52CB\u7AE0\uFF01";break;case 2270006:e="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u8D2D\u4E70";break;default:e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}o.wrap.data("clicked",!1),o.dialog.info('<div class="tip">'+e+"</div>"),0==a.no&&o.dialog.bind("onInfoClose",function(){$.tb.location.reload()})})}}});_.Module.define({path:"ihome/widget/Interaction",sub:{initial:function(n){n?(this.dataObj=n,this._bindEvents()):this._bindFloatEvents()},_resetDataObj:function(n){this.dataObj=n},_follow:function(n,e){var t=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var o=t._addLoading(n,0);$.tb.post("/home/post/follow",{un:e.un,tbs:e.tbs},function(e){if(e)if(0==e.no)t._clearLoading(n,o,0);else if(1990055===e.no)if(t._clearLoading(n,o,1),"undefined"==typeof passport||"undefined"==typeof passport.pop.init){var a="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),r="https://passport";$.JsLoadManager.use([r+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(a/6e4),r+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(a/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else 1130036==e.no?t._showError("\u8BE5\u7528\u6237\u4E0D\u5E0C\u671B\u88AB\u4ED6\u4EBA\u5173\u6CE8",n,0):2260001==e.no?t._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):t._showError("\u5173\u6CE8\u5931\u8D25",n,0);else t._showError("\u5173\u6CE8\u5931\u8D25",n,0)})},_showError:function(n,e,t){var o=new $.dialog({html:'<p style="text-align:center">'+n+"<p>",width:300,height:30});o.bind("onclose",function(){var n=1==t?"btn-sub btn-middle btn_concern_done":"btn_concern btn-attention btn-middle",o=1==t?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8";e.text(o).removeClass().addClass(n)})},_addLoading:function(n,e){var t=$("<span></span>"),o="",a=0,r=[".","..","..."],i=["\u5173\u6CE8\u4E2D","\u53D6\u6D88\u4E2D"],s=setInterval(function(){o=r[a++%3],t.text(o)},400);return n.text(i[e]).append(t),s},_clearLoading:function(n,e,t){var o=1==t?"btn_concern btn-attention btn-small":"btn_concern_done btn-sub btn-small",a=1==t?"\u5173\u6CE8":"\u53D6\u6D88\u5173\u6CE8";n.text(a).removeClass().addClass(o),clearInterval(e)},_unfollow:function(n,e){var t=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var o=t._addLoading(n,1);$.tb.post("/home/post/unfollow",{un:e.un,tbs:e.tbs},function(e){if(e&&0==e.no)t._clearLoading(n,o,1);else if(1990055===e.no)if(t._clearLoading(n,o,1),"undefined"==typeof passport||"undefined"==typeof passport.pop.init){var a="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),r="https://passport";$.JsLoadManager.use([r+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(a/6e4),r+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(a/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else 2260001==e.no?t._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):t._showError("\u53D6\u6D88\u5173\u6CE8\u5931\u8D25",n,1)})},_bindEvents:function(){var n=this;$("#userinfo_wrap").delegate(".btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("#userinfo_wrap").delegate(".btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})},_bindFloatEvents:function(){var n=this;$("body").delegate(".card_headinfo_wrap .btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("body").delegate(".card_headinfo_wrap .btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})}}});_.Module.define({requires:["user/widget/userApi"],path:"common/widget/MemberApi",sub:{initial:function(){},getMemberNameClass:function(e,r){var i="";if(Env.server_time>13962816e5&&Env.server_time<1396368e6&&4!=r)return i=" vip_red ";var t=this.requireInstance("user/widget/userApi",[]),n=$.getPageData("forum.forum_id",0),s={mParr_props:e};return t.checkSingleForumMembershipOf(s,n)&&(i=" vip_red "),e&&e.level&&e.level.end_time>Env.server_time/1e3&&(i=" vip_red "),i}}});_.Module.define({path:"ihome/widget/MonthIcon",sub:{iconTitle:{"01":"\u6469\u7FAF\u5EA7","02":"\u6C34\u74F6\u5EA7","03":"\u53CC\u9C7C\u5EA7","04":"\u767D\u7F8A\u5EA7","05":"\u91D1\u725B\u5EA7","06":"\u53CC\u5B50\u5EA7","07":"\u5DE8\u87F9\u5EA7","08":"\u72EE\u5B50\u5EA7","09":"\u5904\u5973\u5EA7",10:"\u5929\u79E4\u5EA7",11:"\u5929\u874E\u5EA7",12:"\u5C04\u624B\u5EA7"},initial:function(){},getMonthIcon:function(i,n){i=i||{},n=n||1;var t='<div class="month_icon_theme_'+n+'">',o="",e={};for(var a in i){var c=a.length;if(6==c){var h=a.substr(c-2,2);e[h]=i[a]}else 2==c&&(e[a]=i[a])}for(var l in this.iconTitle)o=e&&e[l]?" month_icon_"+l:" month_icon_gray_"+l,t+='<a href="/tbmall/monthicon" target="_blank" title="'+this.iconTitle[l]+'" class="'+o+'"></a>';return t+="</div>"}}});_.Module.define({path:"props/widget/Residual",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions()},initOptions:function(){this.options={1070001:"worship",1070002:"egg"}},getResidualKey:function(i){for(var e=i.props||{},s=null,n="",t=["1070002","1070001"],a=0;a<t.length;a++)if(s=e[t[a]],s&&s.num>0&&s.end_time>Env.server_time/1e3){n=this.options[t[a]];break}return n},showUI:function(i){var e=i.wrap,s="",n=null,t=i.key||this.getResidualKey(i);t&&(s="residual_wrap residual_wrap_"+t,n=e.find(".residual_wrap"),n[0]?n.removeClass().addClass(s):(n=$('<div class="'+s+'"></div>'),e.append(n)))}}});_.Module.define({path:"tbmall/widget/gift_page_ctrl",sub:{giftMap:[],emptyListTpl:"<p>\u8BE5\u7C7B\u76EE\u4E0B\u8FD8\u6CA1\u6709\u793C\u7269\uFF0C\u8BF7\u9009\u62E9\u5176\u4ED6\u7C7B\u76EE~</p>",initial:function(t){this.giftList=t.giftList,this.$container=t.$container,this.rendTpl(),$.isEmptyObject(t.giftList)?this.emptyList():(this.formateData(),this.rendList(),this.rendPoint(),this.updateCursor(),this.updateView(),this.addEvents())},emptyList:function(){var t=this.emptyListTpl;this.$container.html(t)},pointTpl:function(t){var i=0,e="";for(i;t>i;i++)e+='<a href="javascript:;" class="btn-point j-gift-page" id="btn-point-'+i+'" data-page="'+i+'"><i></i></a>';return e},formateData:function(){var t=this,i=0;$.each(t.giftList,function(e,a){i++;var s=i%10,r=Math.floor(i/10);if(0==s&&r--,t.giftMap[r]||(t.giftMap[r]=[]),1==a.activity_type){var n=a.begin_time,p=a.end_time,c=Math.round((new Date).getTime()/1e3);a.is_time_limit=n>c?1:c>p?2:0}t.giftMap[r].push(a)});var e=t.giftMap[t.giftMap.length-1],a=e.length,s=5-a%5;if(5!=s)for(s;s>0;s--)e.push({})},rendTpl:function(){var t=_.template('<div class="gift-center-page">     <div class="gift-center-page-list"></div> </div> <a href="javascript:;" class="gift-center-box-cursor left j-gift-page" data-page="left"></a> <a href="javascript:;" class="gift-center-box-cursor right j-gift-page" data-page="right"></a> <div class="gift-center-box-point"></div>')();this.$container.html(t),this.$pageList=this.$container.find(".gift-center-page-list"),this.$pageCursor=this.$container.find(".j-gift-page")},rendList:function(){var t=_.template("<% for (var itemList in list) {     var len = list[itemList].length;     var type = len/5;     var height = type * 126;     %> <ul class=\"gift-center-list\" id=\"gift-center-list-<%=itemList%>\" style=\"height:<%=height%>px\">     <% for (var i in list[itemList]) {          var item = list[itemList][i];         var type = '';         var timeLimit = 0;         switch (Number(item['activity_type'])) {             case 1 : {                 type = 'time';                 break;             }             case 2 : {                 type = 'num';                 break;             }             case 3 : {                 type = 'sale';                 break;             }             case 4 : {                 type = 'member';                 break;             }             case 5 : {                 type = 'free';                 break;             }         }         if (type == 'time') {             if (item['is_time_limit'] != 0) {                 type = 'time-limit';                 timeLimit = item['is_time_limit'];             }         }         if (item['large_thumbnail_url']) {             var category_id = item['category_id']['category_id'] || item['category_id'];             var tdouNum = 0;             if (item['activity_type'] == 3) {                 tdouNum = item['discount'];             } else {                 tdouNum = item['price'];             }     %>     <li class=\"gift-center-list-item\">         <a href=\"javascript:;\" class=\"gift-center-list-item-link\" id=\"gift-center-list-item-<%=item['gift_id']%>\" data-gift={\"gift_id\":\"<%=item['gift_id']%>\",\"category_id\":\"<%=category_id%>\",\"tdou\":\"<%=tdouNum%>\",\"active\":\"<%=item['activity_type']%>\",\"timeLimit\":\"<%=timeLimit%>\"}>             <img class=\"gift-center-list-item-link-img\" alt=\"<%=item['gift_desc']%>\" src=\"<%=item['large_thumbnail_url']%>\">             <p class=\"gift-center-list-item-link-name\"><%=item['gift_name']%></p>             <div class=\"gift-center-list-item-link-detail\">                 <p class=\"text-overflow\">\u5BF9\u65B9\u83B7\u5F97<%=item['gift_name']%></p>                 <p class=\"text-overflow\">                     <i class=\"icon-tbean\"></i>                     <% if (item['activity_type'] == 3) {%>                     <span class=\"del\"><%=item['price']%></span><span><%=item['discount']%></span>                     <% } else { %>                     <span><%=item['price']%></span>                     <% } %>                 </p>             </div>             <i class=\"icon-select\"></i>             <i class=\"icon-type <%=type%>\"></i>         </a>     </li>     <%} else {%>     <li class=\"gift-center-list-item empty\"></li>     <% } %>     <% } %> </ul> <% } %>")({list:this.giftMap});this.$pageList.html(t),this.setAnimation(),this.page=0},rendPoint:function(){var t=this.giftMap.length;this.total=t-1;var i=this.pointTpl(t);this.$container.find(".gift-center-box-point").html(i),this.$pageList.css({width:631*t})},updateCursor:function(){var t=this.giftMap.length;1==t?this.$pageCursor.remove():this.$pageCursor.eq(0).hide()},updateView:function(){var t=this.page;this.$container.find(".btn-point.active").removeClass("active"),this.$container.find(".btn-point").eq(t).addClass("active"),0==this.page?(this.$pageCursor.eq(0).hide(),this.$pageCursor.eq(1).show()):this.page==this.total?(this.$pageCursor.eq(1).hide(),this.$pageCursor.eq(0).show()):this.$pageCursor.show()},moveToPage:function(){var t=this.page;this.$pageList.animate({"margin-left":631*t*-1})},pagerCtrl:function(t){var i=this;switch(t){case"left":if(0==i.page)return;i.page--,i.updateView(),i.moveToPage();break;case"right":if(i.page==i.total)return;i.page++,i.updateView(),i.moveToPage();break;default:var e=Number(t);if(e>=0){if(e==i.page)return;i.page=e,i.updateView(),i.moveToPage()}}},setAnimation:function(){var t=this.$container.find(".gift-center-list-item"),i=100;$.each(t,function(t,e){i+=50,setTimeout(function(){$(e).addClass("show")},i)})},addEvents:function(){var t=this;t.$container.on("click",".j-gift-page",function(i){var e=$(i.currentTarget),a=e.data("page");t.pagerCtrl(a)})}}});_.Module.define({path:"tbmall/widget/gift_loading_css",sub:{initial:function(){},getTpl:function(){return _.template('<div class="gift-loading">     <div class="object object_one"></div>     <div class="object object_two"></div>     <div class="object object_three"></div>     <div class="object object_four"></div> </div>')()}}});_.Module.define({path:"tbmall/widget/send_gift_dialog",requires:["tbmall/widget/gift_page_ctrl","user/widget/userApi","common/widget/TchargeDialog","common/widget/tdou/tdouViewPay","common/widget/baseUserData","tbmall/widget/gift_loading_css"],sub:{URL:{getGiftTab:"/present/show/getGiftList",getGiftForTab:"/present/show/getGiftListByCategoryId",getFreeGift:"/present/show/getUserFreeChance",sendGift:"/present/pay/placeOrder"},dialogHeight:560,giftMap:{},initial:function(t){return this.toUser=t.userId,this.toUserName=t.userName,this.scene_from=t.scene_from,this.threadId=t.threadId||null,this.postId=t.postId||null,this.fromUser=window.PageData.user.id,this.canSendToSelf=t.canSendToSelf,this.onFail=t.onFail||function(){},this.onSucess=t.onSucess||function(){},this.getUserTdou(),this.$loadingTpl=this.requireInstance("tbmall/widget/gift_loading_css").getTpl(),this.userLevel=this.requireInstance("user/widget/userApi").checkSuperMemberShipOf(PageData.user),this.fromUser?t.toUser!=this.fromUser||this.canSendToSelf?(this.initDialog(),void 0):(this.onFail({no:1,msg:"\u4E0D\u80FD\u7ED9\u81EA\u5DF1\u9001\u793C\u7269\u54E6~"}),void 0):(this.onFail({no:210009,msg:"\u8BF7\u767B\u5F55~"}),void 0)},getUserTdou:function(t){this.baseUserData||(this.baseUserData=this.requireInstance("common/widget/baseUserData")),this.baseUserData.getTdou(function(i){this.userTdou=i.data.Parr_scores.scores_total,t&&t()},this)},getDialogTpl:function(){var t=this,i=_.template('<div class="gift-center-dialog-container">     <div class="gift-center-title">         <h4>\u9001\u7ED9<%=name%></h4>         <a href="javascript:;" class="dialogJclose j-gift-center-title-close"></a>     </div>     <div class="gift-center-box">         <div class="gift-center-box-tab">         </div>         <div class="gift-center-box-list">             <div class="gift-loading"><span></span></div>         </div>     </div> </div> <div class="gift-center-dialog-cashier">     <div class="gift-tr gift-center-dialog-cashier-num">         <p>\u9009\u62E9\u6570\u91CF\uFF1A</p>         <div class="gift-cashier-num-item">             <a href="javascript:;" class="j-gift-num" data-num="1">1</a>             <a href="javascript:;" class="j-gift-num" data-num="99">99</a>             <a href="javascript:;" class="j-gift-num" data-num="520">520</a>             <a href="javascript:;" class="j-gift-num" data-num="999">999</a>             <a href="javascript:;" class="j-gift-num" data-num="1314">1314</a>             <a href="javascript:;" class="j-gift-num gift-num-input" data-num="0">                 <input type="text" class="j-gift-num-input" maxlength="4" placeholder="\u81EA\u5B9A\u4E49" />             </a>         </div>     </div>     <div class="gift-tr gift-center-dialog-cashier-price">         <p>\u6240\u9700T\u8C46\uFF1A</p>         <div class="gift-center-price">             <i class="icon-tbean"></i>             <span class="gift-center-price-tbean j-gift-price">0</span>             <span class="gift-center-price-detail">\uFF08\u5BF9\u65B9\u83B7\u5F97<i class="icon_tbean"></i><span>0</span>\uFF09</span>             <a href="/f?ie=utf-8&kw=\u84DD\u94BB&fr=gift" target="_blank" class="gift-center-price-tips">\u84DD\u94BB\u7528\u9014</a>         </div>     </div>     <div class="gift-tr gift-center-dialog-cashier-btn">         <a href="javascript:;" class="btn-gift-send disabled">\u8D60\u9001</a>         <span class="error-tips"></span>         <span class="txt-tips"></span>     </div> </div> <div class="gift-center-dialog-alert">     <div class="mask"></div>     <div class="loading">         <span></span>         <p>\u5151\u6362\u793C\u7269\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>     </div>     <div class="alert update-tdou">         <p>\u8D2D\u4E70T\u8C46\u6210\u529F\uFF0C\u8BF7\u5237\u65B0\u3002</p>         <a href="javascript:;" class="j-update-tdou">\u5237\u65B0</a>         <a href="javascript:;" class="j-close-alert">\u5173\u95ED</a>     </div>     <div class="alert toast toast-error">         <i></i>         <span>\u8D60\u9001\u5931\u8D25\uFF01</span>     </div>     <div class="alert toast toast-suc">         <i></i>         <span>\u8D60\u9001\u6210\u529F\uFF01</span>     </div> </div>')({name:t.toUserName});return i},initDialog:function(){var t=this,i=t.getDialogTpl(),e={modal:!0,fixed:!0,width:690,height:t.dialogHeight,hideOnclose:!1,holderClassName:"gift-center-dialog",draggable:!1,html:i,closeable:!1,showTitle:!1};t._gift_dialog=new $.dialog(e),t.$_gift_dialog=t._gift_dialog.element,t.$inputCtrl=t.$_gift_dialog.find(".j-gift-num-input"),t.$numCtrl=t.$_gift_dialog.find(".j-gift-num"),t.$btnCtrl=t.$_gift_dialog.find(".btn-gift-send"),t.$tdouView=t.$_gift_dialog.find(".j-gift-price"),t.$blueView=t.$_gift_dialog.find(".gift-center-price-detail span"),t.$blueIcon=t.$_gift_dialog.find(".gift-center-price-detail i"),t.$errorTips=t.$_gift_dialog.find(".error-tips"),t.$txtTips=t.$_gift_dialog.find(".txt-tips"),t.$alertCenter=t.$_gift_dialog.find(".gift-center-dialog-alert"),t.$blueTips=t.$_gift_dialog.find(".gift-center-price-tips"),t.showDialog(function(){t.getGiftList(function(){t.setDefaultGift()})}),t.bindEvent()},setDefaultGift:function(){var t=this;setTimeout(function(){t.$_gift_dialog.find(".gift-center-box-list .gift-center-list-item-link").eq(0).click(),t.$_gift_dialog.find(".j-gift-num").eq(0).click()},1e3)},showDialog:function(t){var i=this;i.top||(i.top=Number(i.$_gift_dialog.css("top").replace("px",""))),i.$_gift_dialog.css({height:0,top:(i.top+i.dialogHeight)/2}).animate({height:i.dialogHeight,top:i.top,display:"block"},function(){i.$_gift_list||(i.$_gift_list=i.$_gift_dialog.find(".gift-center-dialog-container")),t&&t()})},closeDialog:function(t){var i=this;i.$_gift_dialog.animate({height:0,top:(i.top+i.dialogHeight)/2,display:"none"},function(){t&&t()})},getGiftList:function(t){var i=this;$.ajax({url:i.URL.getGiftTab,data:{scene_from:i.scene_from},type:"GET",dataType:"json",success:function(e){0==e.no?(i.rendGiftTpl(e.data),i.addFreeUrl=e.data.addfree_url,i.currency=e.data.currency,t&&t()):i.errorTips()},error:function(){i.errorTips()}})},errorTips:function(t){var i=this;switch(t){case"member":i.$txtTips.html('\u53EA\u6709\u4F1A\u5458\u624D\u53EF\u4EE5\u8D2D\u4E70<a href="javascript:;" class="j-get-member">\u8D2D\u4E70\u4F1A\u5458</a>');break;case"timeLimit":1==i.timeLimit?i.$errorTips.html("* \u9650\u65F6\u793C\u7269\u8FD8\u672A\u4E0A\u67B6"):2==i.timeLimit&&i.$errorTips.html("* \u9650\u65F6\u793C\u7269\u5DF2\u4E0B\u67B6");break;case"tdou":i.$txtTips.html('\u60A8\u7684T\u8C46\u4E0D\u8DB3<a href="javascript:;" class="j-get-tdou">\u83B7\u53D6T\u8C46</a>');break;case"timeIn":var e=i.curGift.end_time,a=Math.round((new Date).getTime()/1e3),s=e-a,r=Math.floor(s/86400),n=Math.floor(s%86400/3600),d=Math.floor(s%86400%3600/60);i.$txtTips.html("\u9650\u65F6\u9500\u552E\uFF1A\u8FD8\u6709"+r+"\u5929"+n+"\u5C0F\u65F6"+d+"\u5206\u949F\u7ED3\u675F");break;case"free":$.ajax({url:i.URL.getFreeGift,data:{scene_from:i.scene_from},type:"GET",success:function(t){0==t.no?(i.limitNum=t.data.free_chance,i.freeCtrl(),i.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">'+t.data.free_chance+'</i>\u4E2A<a href="'+i.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>')):i.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">0</i>\u4E2A<a href="'+i.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>')},error:function(){i.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">0</i>\u4E2A<a href="'+i.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>')}});break;case"num":var o=i.curGift.gift_count;i.$txtTips.html('\u8BE5\u793C\u7269\u9650\u91CF<i class="num">'+o+"</i>\u4E2A")}},rendGiftTpl:function(t){var i=t.list,e=t.list[0].category_id,a=t.gift_list;this.rendTab(i),this.setTab(e),this.giftListRend(e,a)},setTab:function(t){this.$tabList.removeClass("current"),$("#gift-center-tab-"+t).addClass("current")},giftListRend:function(t,i){this.setData(t,i),this.requireInstance("tbmall/widget/gift_page_ctrl",{giftList:i,$container:$(".gift-center-box-list")})},setData:function(t,i){this.categoryId=t,this.giftMap[t]||(this.giftMap[t]={}),this.giftMap[t]=this.formateList(i)},formateList:function(t){var i={};return $.each(t,function(t,e){i[e.gift_id]=e}),i},rendTab:function(t){var i=this,e=_.template('<ul class="gift-center-tab-list">     <% var len = list.length;         var width = (630 - len) / len;         for (var i in list) {         var item = list[i];     %>     <li class="gift-center-tab-item-tr"></li>     <li class="gift-center-tab-item" style="width:<%=width%>px">         <a href="javascript:;" id ="gift-center-tab-<%=item.category_id%>" data-tab={"id":"<%=item.category_id%>"}>             <%=item.category_name%>         </a>     </li>     <%}%> </ul>')({list:t});i.$_gift_dialog.find(".gift-center-box-tab").html(e),i.$tabList=i.$_gift_dialog.find(".gift-center-box-tab").find(".gift-center-tab-item a")},selectGift:function(){var t=this;t.updateGift()},updateGift:function(){$(".gift-center-list-item-link").removeClass("select"),$("#gift-center-list-item-"+this.curGiftId).addClass("select")},setLoading:function(){this.$_gift_dialog.find(".gift-center-box-list").html(this.$loadingTpl)},changeTab:function(t){var i=this;i.setLoading(),i.giftMap&&i.giftMap[t]?(i.setTab(t),i.giftListRend(t,i.giftMap[t])):$.ajax({url:i.URL.getGiftForTab,data:{category_id:t},type:"GET",dataType:"json",success:function(e){if(0==e.no){var a=e.data.gift_list||{};i.setTab(t),i.giftListRend(t,a),i.giftMap[t]=i.formateList(a)}else i.errorTips()},error:function(){i.errorTips()}})},inputCtrl:function(t){var i=parseInt(t,10)||0;0==i?this.$inputCtrl.val(""):t!=i&&this.$inputCtrl.val(i),this.orderNum=i,this.updateBtn()},updateBtn:function(){return this.$txtTips.html(""),this.$errorTips.html(""),this.curGiftId&&this.curCategoryId?this.orderNum?(this.checkOrder()?this.$btnCtrl.removeClass("disabled"):this.$btnCtrl.addClass("disabled"),void 0):(this.$btnCtrl.addClass("disabled"),this.$tdouView.html("0"),this.$blueView.html("0"),void 0):(this.$btnCtrl.addClass("disabled"),this.$tdouView.html("0"),this.$blueView.html("0"),void 0)},setNum:function(t){this.$tdouView.html(t);var i=this.curGift,e=Math.floor((t-(i.tbkey_price||0))*(100-i.proportion)/100);this.$blueView.html(e),0==this.currency?(this.$blueIcon.removeClass().addClass("icon_tbean"),this.$blueTips.hide()):(this.$blueIcon.removeClass().addClass("icon-blue"),this.$blueTips.show())},checkOrder:function(){var t=Number(this.curTdouNum)*Number(this.orderNum);return this.setNum(t),4!=this.activeId||this.userLevel?1!=this.activeId||this.timeLimitCtrl()?t>this.userTdou?(this.tdouNotEnough(),!1):(2==this.activeId&&this.numLimitCtrl(),3==this.activeId&&this.saleCtrl(),5==this.activeId&&this.errorTips("free"),!0):!1:(this.notMember(),!1)},freeCtrl:function(){var t=this.limitNum,i=this.orderNum;i>t&&this.$btnCtrl.addClass("disabled")},notMember:function(){this.errorTips("member")},timeLimitCtrl:function(){return 0!=this.timeLimit?(this.errorTips("timeLimit"),!1):(this.errorTips("timeIn"),!0)},numLimitCtrl:function(){var t=this.curGift,i=t.gift_count;return this.errorTips("num"),i<this.orderNum?!1:!0},saleCtrl:function(){var t=this.curGift.price*Number(this.orderNum),i=Number(this.curTdouNum)*Number(this.orderNum);return this.$txtTips.html('\u6298\u6263\u4FC3\u9500\uFF1A\u539F\u4EF7<i class="del">'+t+'</i>T\u8C46\uFF0C\u73B0\u4EF7<i class="num">'+i+"</i>T\u8C46"),!0},tdouNotEnough:function(){this.errorTips("tdou")},sendGifterror:function(){var t=this;t.$alertCenter.show().find(".loading").hide(),t.$alertCenter.find(".toast-error").show(),setTimeout(function(){t.$alertCenter.hide().find(".toast-error").hide()},1e3)},sendGiftSuc:function(){var t=this;t.$alertCenter.show().find(".loading").hide(),t.$alertCenter.find(".toast-suc").show(),setTimeout(function(){t.$alertCenter.hide().find(".toast-suc").hide()},1e3)},getOrder:function(){var t=this;t.$btnCtrl.addClass("disabled"),t.$alertCenter.show().find(".loading").show(),$.ajax({url:t.URL.sendGift,data:{scene_from:t.scene_from,gift_id:t.curGiftId,num:t.orderNum,benefit_userid:t.toUser,benefit_username:t.toUserName,thread_id:t.threadId,post_id:t.postId},type:"POST",dataType:"json",success:function(i){if(0==i.no)if(5==t.activeId)t.sendGiftSuc(),t.limitNum=i.data.free_chance,t.freeCtrl(),t.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">'+i.data.free_chance+'</i>\u4E2A<a href="'+t.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>'),t.$btnCtrl.removeClass("disabled");else{var e=i.data;$.extend(e,{chargeType:"platform",notShowSucTips:!0});var a=t.requireInstance("common/widget/tdou/tdouViewPay",function(e){if("encourage_dialog_closed"==e.command?t.$alertCenter.hide().find(".loading").hide():"encourage_paid"==e.command?0==e.data.no?t.sendGiftSuc():t.sendGifterror():t.sendGifterror(),2==t.activeId){var a=i.data.gift_count;t.curGift.gift_count=a,t.numLimitCtrl()?t.$btnCtrl.removeClass("disabled"):t.$btnCtrl.addClass("disabled")}else t.$btnCtrl.removeClass("disabled")});a.createMain(e)}else t.$btnCtrl.removeClass("disabled"),t.sendGifterror()},error:function(){t.$btnCtrl.removeClass("disabled"),t.sendGifterror()}})},updateTdou:function(){var t=this.orderNum*this.curTdouNum-this.userTdou,i={consumption_path:"send-gift",fr:"send-gift",current_need_tdou:t,is_direct_cashier:!0};this.requireInstance("common/widget/TchargeDialog",i),setTimeout(function(){this.$alertCenter.show().find(".update-tdou").show()},1e3)},bindEvent:function(){var t=this;t.$_gift_dialog.on("click",".j-gift-center-title-close",function(){t.closeDialog(function(){t._gift_dialog.close()})}).on("click",".gift-center-list-item-link",function(i){var e=$(i.currentTarget),a=e.data("gift");t.curGiftId=a.gift_id,t.curCategoryId=a.category_id,t.curTdouNum=a.tdou,t.activeId=a.active,t.timeLimit=a.timeLimit,t.curGift=t.giftMap[t.curCategoryId][t.curGiftId],t.selectGift(),t.updateBtn()}).on("click",".gift-center-tab-item a",function(i){var e=$(i.currentTarget),a=e.data("tab"),s=a.id;t.changeTab(s),t.curCategoryId=null,t.curGiftId=null,t.curTdouNum=null,t.activeId=null,t.timeLimit=null,t.updateBtn()}).on("input",".j-gift-num-input",function(i){var e=$(i.currentTarget),a=e.val();t.inputCtrl(a)}).on("click",".j-gift-num",function(i){var e=$(i.currentTarget);t.$numCtrl.removeClass("select"),e.addClass("select");var a=Number(e.data("num"))||0;t.orderNum=a,0==a?(t.$inputCtrl.focus(),t.inputCtrl(t.$inputCtrl.val())):(t.$inputCtrl.val(""),t.updateBtn())}).on("click",".btn-gift-send",function(i){var e=$(i.target);e.hasClass("disabled")||t.getOrder()}).on("click",".j-get-tdou",function(){t.updateTdou()}).on("click",".j-close-alert",function(){t.$alertCenter.hide().find(".alert").hide()}).on("click",".j-update-tdou",function(){t.getUserTdou(function(){t.checkOrder(),t.$alertCenter.hide().find(".alert").hide()})})}}});_.Module.define({path:"ihome/widget/UserVisitCard",requires:["common/widget/Card","UserVisitCardBase","ihome/widget/Interaction","props/widget/Residual","common/widget/JoinVipDialog","tbmall/widget/send_gift_dialog"],sub:{_visit_card:null,_visit_card_ajax:null,_option:{width:370},initial:function(a,i){window.Page&&Page.checkLoadedModules("UserVisitCard")||(this.dataObj=a,this._wrap=$("body"),this._util=this.use("userVisitCardBase"),this._interaction=this.use("ihome/widget/Interaction"),this._residual=this.use("props/widget/Residual"),i||this.bindEvents())},bindEvents:function(){var a=this;this._wrap.delegate(".j_user_card","mouseenter",function(){return a.buildCard($(this)),!1}),this._wrap.delegate(".j_user_card","mouseleave",function(){return a._visit_card_ajax&&a._visit_card_ajax.abort(),a._visit_card&&a._visit_card.closeCard({type:"delayClose",time:200}),a._visit_card=null,!1}),this._wrap.on("click","[j-user-visit-card-marriage-propose]",function(){var i=$(this);a.marryDialog={},a.marryDialog.hide=a.marryDialog.show=function(){};var t=i.tbattr("data-username");a.requireInstanceAsync("encourage/widget/post_marry",{type:"float",propose_name:t},function(i){a.marryDialog=i})}),this._wrap.on("click","[j-user-visit-card-send-gift]",function(i){var t=$(i.target),e=t.data("userid"),r=t.data("username");a.requireInstance("tbmall/widget/send_gift_dialog",{userId:e,userName:r,scene_from:"pc_home",account:"",onSuccess:function(){$.tb.location.reload()},onFail:function(){$.tb.location.reload()}})}),this._wrap.delegate(".card_userinfo_close","click",function(){return $("#user_visit_card").remove(),!1})},buildCard:function(a){var i=this;i._visit_card&&(i._visit_card.closeCard(),i._visit_card=null);var t='<div class="user_card_loading"><img src="//tb2.bdstatic.com/tb/static-ihome/img/loading2.gif"/>\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>',e={content:t,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:a,attr:"id='user_visit_card'",wrap:$("body")};i._visit_card=i.use("common/widget/Card",e),i._visit_card.showCard({type:"delayShow",time:200}),i.buildVisitCard(a)},getVisitCardContent:function(a){var i=this,t={ie:"utf-8"};a.un?t.un=a.un:t.id=a.id,$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data;e.bg_id=a.bg_id;var r=i._util.getVisitCardTpl(1,e,!0);a.wrap.html(r)}else{var r='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';a.wrap.html(r)}a.callBack&&$.isFunction(a.callBack)&&a.callBack()})},buildVisitCard:function(a){var i=this,t={ie:"utf-8"};a.getData().un?t.un=a.getData().un:t.id=a.getData().id,i._visit_card_ajax&&i._visit_card_ajax.abort(),i._visit_card_ajax=$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data,r=e.name==i.dataObj.uname,s=i._util.getVisitCardTpl(r,e,!0);i._visit_card.setContent(s),i._visit_card._j_card.bindData({un:e.name}),i._visit_card.showCard(),i._interaction._resetDataObj({is_login:PageData.user.is_login,un:e.name,tbs:PageData.tbs}),i._residual.showUI({wrap:$("#user_visit_card .userinfo_head_wrap"),props:e.appraise||{}}),i._visit_card._j_card.find(".j_user_visit_card_joinvip").on("click",function(){_.Module.use("common/widget/JoinVipDialog",[],function(a){a.getMemberDialog()})}),$.stats.track("cardinfo","ihome_v1")}else{var s='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';i._visit_card.setContent(s),$("#user_card_reload").on("click",function(){return i.buildCard(a),!1})}})},bindVisitCardEvent:function(){var a=this;a._visit_card.showCard({type:"delayShow",time:200}),$.stats.track("cardinfo","ihome_v1")}}});
;_.Module.define({path:"ihome/widget/UserVisitCard/UserVisitCardBase",requires:["user/widget/Icons","common/widget/UserHead","common/widget/MemberApi","ihome/widget/MonthIcon"],sub:{countLen:0,initial:function(){},getVisitCardTpl:function(e,a,i){var r="\u4ED6";if("female"===a.sex)var r="\u5979";var t=PageData.product||"",n=this.use("user/widget/Icons"),s=this.use("common/widget/UserHead"),o=this.use("ihome/widget/MonthIcon"),c=this.use("common/widget/MemberApi"),l=s.getHeadFrameStyle(a,"105"),_={head_img:"/tb/static-ihome/img/panel_"+a.bg_id+".jpg",concernClass:"0"==a.can_followed?"btn_concern_done btn-sub":"btn_concern btn-attention",concernText:"0"==a.can_followed?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8",un:encodeURIComponent(a.name),btn_group:i?this.getBtnGroup(a):"",frameClass:l.hasFrame?"card_userinfo_left_frame":"",frameStyle:l.stylestr,portrait:s.getHeadUrl(a),fr:t,icon_pre:n.getPreIconHtml(a.mParr_props,a),member_class:c.getMemberNameClass(a.mParr_props,a.free_flag),name:a.profession_manager_nick_name||a.name_show,icon_tbvip:n.getTbvipIconHtml(a.tb_vip),icon:n.getIconsHtml(a),sex:a.sex,tb_age:"-"==a.tb_age?a.tb_age:a.tb_age+"\u5E74",post_num:a.post_num,good_num:a.good_num,honor:o.getMonthIcon(a.tbmall_month_icon,2),honor_margin:this.getHonorMargin(),vip_tips:this.getVipTips(a),userId:a.id};a.is_verify&&"0"!==a.is_verify&&(_.verify_info=this.getVerifyHTML(a.identify_info));var m="";a.tb_vip&&a.tb_vip.type&&(m='<span class="userinfo_split"></span><span>\u7C89\u4E1D:'+a.followed_count+"</span>");var d="",f="",g="";!a.marriage||1!=a.marriage.status&&3!=a.marriage.status&&4!=a.marriage.status?a.marriage&&0!=a.marriage.length&&2!=a.marriage.status||(g='<a class="btn-attention btn-small  user-visit-card-marriage-propose" data-username="'+a.name+'" data-userid="'+a.id+'" j-user-visit-card-send-gift><i></i>\u7ED9'+r+"\u9001\u793C</a>"):(_.marriage_date=$.dateFormat(new Date(1e3*a.marriage.time),"yyyy-MM-dd"),_.marriage_user_name=a.marriage.user_name,d=['<div class="card_userinfo_marry clearfix">','<span class="userinfo_marry_lover">\u7231\u4EBA:#{marriage_user_name}</span>',"</div>"].join(""),f=['<div class="card_userinfo_marry clearfix">','<span class="userinfo_marry_date">\u7ED3\u5A5A\u7EAA\u5FF5\u65E5: #{marriage_date}</span>',"</div>"].join(""));var u="";e||(u='<div class="interaction_wrap interaction_wrap_theme2">'+g+'<a class="btn-small #{concernClass}" target="_blank" href="#" onclick="return false">#{concernText}</a><a class="btn-small btn-default" target="sixin" href="/im/pcmsg?from=#{userId}">\u79C1\u4FE1</a></div>');var v=$.tb.transforEmoji(a.user_name,a.name_show,!0),p="";v.indexOf("activityTemp")>-1&&(p='<div style="position:absolute;right:5px;background-color:#F5F7FA;"><div class="change_name" style="font-size: 12px;display:inline-block;height:20px;line-height:20px;margin-left:5px;float:left"><img src="//tb1.bdstatic.com/tb/cms/nickemoji/nickname_sign_ani.gif" style="height:12px;" /></div><a style="cursor:pointer" href="https://tieba.baidu.com/n/interact-web/nicknameActivity"><span style="font-size:12px;height:20px;line-height:20px;vertical-align:top;margin-left:5px">\u6211\u4E5F\u6539</span></a></div>');var b=['<div class="card_headinfo_wrap" id="card_headinfo_wrap">','<img class="card_userinfo_img" src="#{head_img}"/>','<a class="card_userinfo_guide" target="_blank" href="/tbmall/propslist?category=113"></a>',u,"</div>",'<div class="card_userinfo_wrap clearfix">','<div class="card_userinfo_left #{frameClass}">','<div class="userinfo_head_wrap">','<div class="userinfo_head" style="#{frameStyle}"></div>','<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" class="j_avatar" target="_blank"><img src="#{portrait}"/></a>','<a href="javascript:" class="marriage" j-user-visit-card-marriage-propose target="_blank"><i></i>\u5411',r,"\u6C42\u5A5A</a>","</div>","</div>",'<div class="card_userinfo_middle">','<div class="card_userinfo_title clearfix">','#{icon_pre}<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" target="_blank" class="userinfo_username #{member_class}">'+v+"</a>#{icon_tbvip}",p,"</div>",d,'<div class="card_userinfo_num clearfix">','<span class="userinfo_sex userinfo_sex_#{sex}"></span>',"<span>\u5427\u9F84:#{tb_age}</span>",'<span class="userinfo_split"></span>',"<span>\u53D1\u8D34:#{post_num}</span>",m,"</div>",f,'<div class="card_userinfo_tbvip clearfix">',"#{icon}","</div>","#{vip_tips}","</div>","</div>","#{verify_info}"].join("");return $.tb.format(b,_)},getBtnGroup:function(e){var a="";if(e.id!==PageData.user.id){var i=e.can_begcard,r="";0==i?r='<a class="btn_begcard j_begcard" href="#"></a>':1==i?r='<a class="btn_begcard btn_forbidden">\u5DF2\u7533\u8BF7</a>':2==i&&(r='<a class="btn_begcard btn_forbidden">\u5DF2\u4EA4\u6362</a>');var t={private_msg:"http://msg.baidu.com/ms?ct=21&cm=1&tn=bmSendMessage&un="+encodeURIComponent(e.name),btn_begcard:r};a=['<div class="card_btn_grounps">','<a class="btn_privatemsg" target="_blank" href="#{private_msg}"></a>',"#{btn_begcard}","</div>"].join(""),a=$.tb.format(a,t)}return a},getIcon:function(e){var a="";return e.identity&&(a+='<span title="\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1" class="card_userinfo_icon card_icon_verify"></span>'),e.meizhi_level>0&&(a+='<a href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1" class="card_userinfo_icon meizhi_vip card_icon_meizhi_vip'+e.meizhi_level+'"></a>'),a},getHonor:function(e){if(e.novice)return'<div class="grade_level grade_level_novice" title="\u8D34\u5427\u83DC\u9E1F">\u8D34\u5427\u83DC\u9E1F</div>';var a={manager:{title:"\u5427\u4E3B",level:19},assist:{title:"\u5C0F\u5427\u4E3B",level:20},picadmin:{title:"\u56FE\u7247\u5C0F\u7F16",level:21},videoadmin:{title:"\u89C6\u9891\u5C0F\u7F16",level:22},novice:{title:"\u83DC\u9E1F",level:23}},i=e.manager,r=null,t="",n="";this.countLen=0;for(var s in i){r=i[s];var o=r.forum_list.join("\u3001"),c=a[s];o=r.count>2?o+"\u7B49\u5427"+c.title:o+"\u5427"+c.title,t+=this.getHonorItem(c.level,r.count,o),this.countLen+=String(r.count).length}var l=e.grade,_=[];for(var m in l)_.push(m);_.sort(function(e,a){return a-e});for(var d=0,f=_.length;f>d;d++){r=l[_[d]];var o=r.forum_list.join("\u3001");r.count>2&&(o+="\u5427\u7B49"),n+=this.getHonorItem(_[d],r.count,o),this.countLen+=String(r.count).length}return t+n},getHonorMargin:function(){var e={2:"8px",3:"6px",4:"4px"},a=this.countLen-4;return e[a]||""},getHonorItem:function(e,a,i){var r={level:e,title:i,count:a},t=['<div class="grade_level grade_level_#{level}" title="#{title}">',"<span>#{count}</span>","</div>"].join("");return $.tb.format(t,r)},getVerifyHTML:function(e){for(var a={verify_reason:e[0]&&e[0].v_reason,verify_forums:""},i=['<div class="verify_wrap">','<div class="verify_content">','<div class="verify_desc">',"<span>\u5B98\u65B9\u8BA4\u8BC1\uFF1A</span>","<span>#{verify_reason}</span>","</div>",'<div class="verify_forum">','<a class="verify_home" href="http://v.tieba.baidu.com/" target="_blank">\u7533\u8BF7\u4F01\u4E1A\u5B98\u65B9\u5427</a>',"<span>\u5165\u9A7B\u5427\uFF1A</span>","#{verify_forums}","<span>\u5B98\u65B9\u5427\u4E3B</span>","</div>","</div>","</div>"].join(""),r=0;r<e.length;r++)a.verify_forums+=this.getVForumItem(r,e[r].forum_name);return $.tb.format(i,a)},getVForumItem:function(e,a){var i="",r={},t=[];return a.length>5?(i=a.substring(0,5),i+="..."):i=a,r={index:e,verify_forum_name:i,origin_forum_name:encodeURIComponent(a)},t=['<span class="verify_forum_info">','<a target="_blank" class="verify_forum_name_#{index}" href="/f?ie=utf-8&kw=#{origin_forum_name}">#{verify_forum_name}</a>','<a target="_blank" href="http://v.tieba.baidu.com/">','<img class="verify_forum_icon" src="//tb2.bdstatic.com/tb/static-ihome/img/platform_blue_icon14.gif" alt="\u5B98\u65B9\u8BA4\u8BC1\u56FE\u6807" title="\u767E\u5EA6\u8D34\u5427\u5B98\u65B9\u5E73\u53F0\u8BA4\u8BC1">',"</a>","</span>"].join(""),$.tb.format(t,r)},getVipTips:function(e){var a="",i=(new Date).getTime()/1e3;return e.mParr_props&&e.mParr_props.level&&e.mParr_props.level.end_time>i&&(a='<p class="user_card_vip_tips"><a href="javascript:;" class="j_user_visit_card_joinvip" target="_blank">\u5F00\u901A\u4F1A\u5458</a>\u5C0A\u4EAB\u6635\u79F0\u7EA2\u540D\u7279\u6743 <a href="/tbmall/tshow?tab=detail&c=15" target="_blank">\u4E86\u89E3\u7279\u6743</a> </p>'),a}}});_.Module.define({path:"tbmall/component/HeadPreview",requires:["common/widget/UserHead","tbmall/component/util","props/component/Guide","tbmall/component/UseController","ihome/widget/UserVisitCard"],sub:{initial:function(){this.initUI(),this.initFlashCallbacks(),this.guide=this.use("props/component/Guide"),this.visitCard=this.use("ihome/widget/UserVisitCard"),this.useC=this.use("tbmall/component/UseController"),this.util=this.use("tbmall/component/util")},options:{pngCount:{1090001:3,1090002:5,1090003:5,1090004:4,1090005:5,1090006:5,1090007:5,1090008:4,1090009:5,1090010:5,1090011:5,1090012:4,1090013:5},propIdForProp:{101:"bub",104:"font",108:"card",116:"card",117:"card",118:"card",114:"card",103:"printer"},stylesForAllPreview:{110:"frame",109:"frame"}},_centerElement:function(e){var t=e.height(),i=e.width();e.css({width:i,height:t,top:"50%",left:"50%","margin-left":-(i/2),"margin-top":-(t/2)})},_getData:function(e){$.json.encode($(e).closest("li.item").data("field"));return $(e).closest("li.item").getData()},doPreview:function(e){{var t=this,i=$.json.encode($(e).closest("li.item").data("field")),a=t._getData(e),r=a.props_category,s=a.props_id;t.options.stylesForAllPreview[r]}switch(r){case"107":t.$loading.remove(),t.guide.showMagicGuide(s);break;case"109":t._buildPreviewUI(t.getHtmlFor109(a.props_id)),t.guide.$guideWrap.css({"margin-left":"-175px","margin-top":"-150px"}),t.hasFrame&&t.guide.$guideWrap.css({width:350,height:205,backgroundPosition:"105px 40px"});break;case"110":t._buildPreviewUI(t.getHtmlFor110(a.props_id));break;case"113":if(!PageData.user.is_login)return _.Module.use("common/widget/LoginDialog"),void 0;t._buildPreviewUI(t.getHtmlForOther(a.props_id)),t.guide.$guideWrap.css({"margin-left":"-200px"}),t.visitCard.getVisitCardContent({un:PageData.user.user_name,id:PageData.user.portrait,wrap:t.guide.$guideContent.find(".card_preview"),bg_id:a.props_id,callBack:function(){t.guide.$guideContent.find(".card_userinfo_img").one("load",function(){t._centerElement(t.guide.$guideWrap)})}});break;default:t._buildPreviewUI(t.getHtmlForOther(a.props_id))}t._buildChargeInfo(i,a),this.initToBuy(),this.initUse()},_buildChargeInfo:function(e,t){var i=this,a=("0"==t.props_type?t.free_user_level:2,i.util.getFreeInfo(t)),r=i.initBuyInfo(e);i.guide.$guideContent.append(r),"107"!=t.props_category&&i.guide.$guideContent.append(a)},_buildPreviewUI:function(e){var t=this;this.guide.initPreviewUI(),this.guide.$guideContent.html(e);var i=$(e).find(".j_resource_loading");i.length>0&&this.guide.$guideWrap.hide(),i.length>0&&i.one("load",function(){t._centerElement(t.guide.$guideWrap),t.guide.$guideWrap.show()})},initUI:function(){this.$portraitWrap=$('<div id="portrait_wrap" class="portrait_wrap"></div>'),this.$portraitFlash=$('<div class="portrait_flash"></div>'),this.$loading=$('<img class="portrait_loading" src="/tb/static-tbmall/img/loading.gif"/>'),this.$portraitWrap.append(this.$portraitFlash).append(this.$loading)},getHtmlForOther:function(e){var t=this,i=e.slice(0,3),a="",r="png",s={1170001:"-1~2",1170002:"0~3",1170003:"2~5",1170004:"5~8",1170005:"10~15"},o={108:'<p class="prop_intro">\u8FDE\u7EED\u7B7E\u5230\u795E\u5668\u3002\u9EBB\u9EBB\u518D\u4E5F\u4E0D\u7528\u62C5\u5FC3\u6211\u6F0F\u7B7E\u4E86\uFF01</p>',117:'<p class="prop_intro">\u4E3A\u697C\u4E3B\u633D\u5C0A\uFF0C\u88AB\u633D\u5C0A\u7528\u6237\u7ECF\u9A8C\u503C\u589E\u52A0('+(s[e]||"")+")\u3002</p>",116:'<p class="prop_intro">\u7ED9\u5973\u795E\u544A\u767D\uFF0C\u53EB\u57FA\u53CB\u56DE\u5BB6\u5403\u996D\uFF0C\u8BA9\u4F60\u7684\u53D1\u8A00\u63B7\u5730\u6709\u58F0\uFF01</p>',118:'<p class="prop_intro">\u4F1A\u5458\u5427\u4E3B\u4E13\u5C5E\u91D1\u8272\u7F6E\u9876\uFF0C\u4E0D\u53EF\u9690\u85CF\uFF0C\u5C0A\u8D35\u8EAB\u4EFD\uFF0C\u7ACB\u523B\u5F70\u663E\u3002</p>'};("1040003"===e||"1040011"===e||"1080002"===e)&&(r="gif");var n=["//tb1.bdstatic.com/tb/cms/tbmall/",t.options.propIdForProp[i],"/pc/"+e,"."+r].join("");return a+="113"===i?['<div class="card_preview">','<img class="card_loading" src="/tb/static-tbmall/img/loading.gif"/>','</div><div class="card_mask">'].join(""):['<div class="preview">','<img class="j_resource_loading" src="'+n+'" alt="\u56FE\u7247\u9884\u89C8" />'].join(""),a+=o[i]||"",a+="</div>"},_initUserHead:function(){this.userHead||(this.userHead=this.use("common/widget/UserHead"))},getHtmlFor109:function(e){var t=this,i="portrait="+PageData.user.portrait+"&props_id="+e+"&png_count="+t.options.pngCount[e],a="/tb/static-tbmall/swf/GIFMaker.swf?t=14010902",r='<embed width="150" height="150" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+i+'" allowfullscreen="true" wmode="transparent" allowscriptaccess="always" quality="high" bgcolor="#FFFFFF" src="'+a+'" type="application/x-shockwave-flash">';this.$portraitFlash.html(r),t._initUserHead();var s=this.userHead.getHeadFrameStyle(PageData.user,"150");s.hasFrame&&t.$portraitFlash.css({position:"static"});var o=t.$portraitWrap[0].outerHTML;return s.hasFrame&&(o='<div style="'+s.stylestr+'" class="head_preview_wrap">'+o+"</div>",t.hasFrame=!0),o},getHtmlFor110:function(e){this._initUserHead();var t=this.userHead,i=t.getImgFormat(e),a=["background-image: url(/tb/static-common/img/props/150/"+e+"."+i+")","background-repeat: no-repeat","background-position: center 0"],r=a.join(";");return'<a style="'+r+'" class="head_preview_wrap"><img class="j_resource_loading" src="'+t.getHeadUrl(PageData.user||{})+'"/></a>'},initFlashCallbacks:function(){window.finishMerge=function(){$("#portrait_wrap .portrait_loading").remove()}},initBuyInfo:function(e){var t=this,i=$.json.decode(e),a=PageData.user.is_login?t._buyInfoTpl(i):['<a class="ui_btn ui_btn_sub_s j_buy_button1">',"<span><em>\u5151&nbsp;&nbsp;\u6362</em></span>","</a>"].join(""),r="0"===i.props_type?t.util.convertToDay(i.time_interval):"1\u4E2A";return['<div class="j_buy_wrapper" data-field = '+e+">",'<p class="cost_info">',i.scores,"T\u8C46/",r,"</p>",a,"</div>"].join("")},_buyInfoTpl:function(e){var t=this.util.getBuyInfo(e);return t},initToBuy:function(){var e=this;$(".guide_wrap").delegate(".j_buy_button1","click",function(t){t.preventDefault();var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.use("tbmall/component/BuyController",$(this),i)})},initUse:function(){var e=this;$(".guide_wrap").delegate(".j_use","click",function(t){var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.useC.doUse($(this),i),t.preventDefault()}),$(".guide_wrap").delegate(".j_cancle_use","click",function(t){var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.useC.cancelUse($(this),i),t.preventDefault()}),$(".guide_wrap").delegate(".j_get_button1","click",function(t){e.guide.closeGuide(),e.use("tbmall/widget/getProp",$(this)),t.preventDefault()}),$(".guide_wrap").delegate(".j_tbmall_join_vip_btn","click",function(t){e.requireInstance("common/widget/JoinVipDialog",[]).getMemberDialog();var i=$(this).closest(".guide_content").find("div.j_buy_wrapper").getData();e._statClick(i),t.preventDefault()})},_statClick:function(e){switch(parseInt(e.props_category)){case 110:this._postTrack("\u5934\u50CF\u8FB9\u6846",e.props_id);break;case 109:this._postTrack("\u52A8\u6001\u5934\u50CF",e.props_id);break;case 113:this._postTrack("\u540D\u7247\u80CC\u666F",e.props_id);break;case 104:this._postTrack("\u70AB\u5F69\u5B57\u4F53",e.props_id);break;case 101:this._postTrack("\u53D1\u5E16\u6C14\u6CE1",e.props_id);break;case 103:this._postTrack("\u56FE\u7247\u6C34\u5370",e.props_id);break;case 108:this._postTrack("\u8865\u7B7E\u795E\u5668",e.props_id);break;case 117:this._postTrack("\u633D\u5C0A\u5361",e.props_id);break;case 107:this._postTrack("\u9B54\u6CD5\u5F39",e.props_id);break;case 118:this._postTrack("\u7F6E\u9876\u5361",e.props_id)}},_postTrack:function(e,t){$.stats.track(e,"\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"\u5F00\u901A\u7684\u70B9\u51FB\u91CF3",obj_id:t})}}});_.Module.define({path:"tbmall/component/BuyController",requires:["tbmall/component/captcha_payment","tbmall/component/NetProxy","tbmall/component/Dialog","tbmall/widget/ContSignCard","tbmall/component/util","tbmall/component/HeadPreview","tbmall/component/UseController","tbmall/widget/paykey_dialog","tbmall/widget/TbeanSafe"],sub:{buy_number:0,set_pass_tpl:'<div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div>',buy_tpl0:'<div class="buy_tpl clearfix"> <div class="buy_tpl_left"><div class="prop_img"><img src="#{imgsrc}"></div><div class="title">#{title}</div><div class="price">#{price_unit}</div></div> <div class="buy_tpl_right"><div class="price_tip">\u60A8\u9700\u8981<span class="strong_txt">#{price}</span>T\u8C46\u5151\u6362\u9053\u5177</div> #{TbeanCharge}<a class="ui_btn ui_btn_sub_m j_confirm_buy j_buy_button"><span><em>\u786E\u8BA4\u5151\u6362</em></span></a><div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div></div></div> ',buy_tpl1:['<div class="buy_tpl buy_count_tpl clearfix">',' <div class="buy_tpl_left"><div class="prop_img"><img src="#{imgsrc}"></div><div class="title">#{title}</div><div class="price">#{price_unit}</div>','</div> <div class="buy_tpl_right">','<p class="count_tip">\u60A8\u8981\u5151\u6362\u7684\u6570\u91CF</p>','<div class="count_wrap clearfix"><span class="count_number">\u6570\u91CF\uFF1A</span>','<span class="counter"><button class="j_minus minus"></button><input type="text" class="j_count" value="1"/><button class="j_plus plus"></button></span><span>\u4E2A</span>',"</div>",'<div class="count_tip count_sub_tip">\u9700\u8981T\u8C46\uFF1A<span class="t_dou_needed strong_txt">#{price}</span>\u4E2A  \u60A8\u76EE\u524DT\u8C46\uFF1A<span class="cur_t_dou">#{cur_t_dou}</span>\u4E2A</div>',"#{TbeanCharge}",'<div class="buy_and_tip"><a class="ui_btn ui_btn_sub_m j_confirm_buy j_buy_button"><span><em>\u786E\u8BA4\u5151\u6362</em></span></a><span class="error_tip"></span></div>','<div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div>'," </div></div> "].join(""),initial:function(e,t){this.data=t;$.stats.track(this.data.props_id,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u70B9\u51FB\u5151\u6362"),this.netProxy=this.use("tbmall/component/NetProxy"),this.dialog=this.use("tbmall/component/Dialog"),this.util=this.use("tbmall/component/util"),this.headPreview=this.use("tbmall/component/HeadPreview"),this.useController=this.use("tbmall/component/UseController"),this.isAvailable()&&this.doBuy(e),$(e).data("clicked",!1)},isAvailable:function(){var e=this.data,t=this,a=PageData.scores,s=null!=a.scores_money?parseInt(a.scores_money):0,n=null!=a.scores_other?parseInt(a.scores_other):0,i=s+n,o=Math.min(parseInt(a.scores_fetch),parseInt(t.data.fetch_scores_limit||0)),c=parseInt(i+o);return PageData.user.is_login?PageData.user.no_un?(TbCom.process("User","BuildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u53EF\u4EE5\u5728T\u8C46\u5546\u57CE\u8D2D\u7269\u5662~"),!1):c<parseInt(e.scores)?(t.dialog.dialog("<p class='dialog_content'>T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C\u5151\u6362\u9053\u5177\u9700\u8981<span class='charge_bean_interaction_orange_tip' >"+e.scores+"</span>T\u8C46</p><div class='charge_bean_interaction_dialog_btn_wrap'><a class='charge_bean_interaction_charge_btns charge_bean_interaction_j_charge_btn' id='j_tcharge_dialog_tbmall'>\u83B7\u53D6T\u8C46</a><a class='charge_bean_interaction_charge_btns charge_bean_interaction_j_close_dialog'>\u53D6\u6D88</a></div>"),$("#j_tcharge_dialog_tbmall").on("click",function(){var t={consumption_path:"12",desc:"\u5151\u6362\u9053\u5177",current_need_tdou:parseInt(e.scores,10)-i,is_direct_cashier:!0,is_iframe:!0};_.Module.use("common/widget/tcharge_dialog",t)}),!1):!0:(TbCom.process("User","buildLoginFrame"),!1)},bindCountEvent:function(e){var t=this,a=t._buyDialog,s=a.element.find(".j_count");a.element.on("click",".j_minus",function(){var a=parseInt(s.val())||1;a=Math.max(1,a-1),a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a);var n=Math.min(PageData.scores.scores_fetch,(t.data.fetch_scores_limit||0)*a);$(".Tbean_num").text(n),t.checkCountError()}).on("click",".j_plus",function(){var a=parseInt(s.val())||1;a++,a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a);var n=Math.min(PageData.scores.scores_fetch,(t.data.fetch_scores_limit||0)*a);$(".Tbean_num").text(n),t.checkCountError()}),s.on("input propertychange",function(){var a=/^[1-9]\d*$/,n=s.val();(n&&!a.test(n)||a.test(n)&&n>999)&&(n=n.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),n=Math.min(999,n),s.val(n)),$(".t_dou_needed").text(e*n),t.checkCountError()}).on("blur",function(){var a=s.val()&&parseInt(s.val())>0&&parseInt(s.val())||1;a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a),t.checkCountError()})},checkCountError:function(){var e=this,t=e._buyDialog,a=t.element.find(".t_dou_needed"),s=t.element.find(".error_tip"),n=t.element.find(".j_count"),i=n.val(),o=t.element.find(".j_buy_button"),c=PageData.scores,l=parseInt(c.scores_money+c.scores_other),r=Math.min(parseInt(c.scores_fetch),parseInt(e.data.fetch_scores_limit||0)),_=parseInt(l+r);return 999==i?(s.text("\u5355\u6B21\u9650\u5151999\u4E2A"),s.show()):s.hide(),_<parseInt(a.text())?(s.text("T\u8C46\u4F59\u989D\u4E0D\u8DB3"),s.show(),o.addClass("ui_btn_disable ui_btn_m_disable").removeClass("ui_btn ui_btn_sub_m j_confirm_buy"),!1):(s.hide(),o.addClass("ui_btn ui_btn_sub_m j_confirm_buy").removeClass("ui_btn_disable ui_btn_m_disable"),!0)},doBuy:function(){var e,t=this.data,a=this,s="",n="",i=parseInt(t.fetch_scores_limit,10)||0,o=PageData.scores.scores_fetch;n=0===i||0===o?"":['<div class="TbeanCharge_container">','<input id="j_charge_checked" type="checkbox" name="TbeanCharge_check" />','\u53EF\u4F7F\u7528<span class="icon_Tbean_num"></span><span class="Tbean_num">',Math.min(o,i),"</span>\u8C46\u7968\u62B5\u7528T\u8C46","</div>"].join(""),"0"==t.props_type?(PageData.user.setpass&&(a.buy_tpl0=a.buy_tpl0.replace("buy_tpl_set_pass","buy_tpl_set_none")),s=$.tb.format(a.buy_tpl0,{price:t.scores,price_unit:t.scores+"T\u8C46/"+a.util.convertToDay(t.time_interval),title:t.name,imgsrc:t.imgsrc,level:t.free_user_level,TbeanCharge:n}),e=480):"1"==t.props_type&&(PageData.user.setpass&&(a.buy_tpl1=a.buy_tpl1.replace("buy_tpl_set_pass","buy_tpl_set_none")),s=$.tb.format(a.buy_tpl1,{price:t.scores,price_unit:t.scores+"T\u8C46/1\u4E2A",title:t.name,imgsrc:t.imgsrc,cur_t_dou:PageData.scores.scores_total,level:2,TbeanCharge:n}),e=560);var c=220;PageData.user.setpass&&(c=200),a._buyDialog=new $.dialog({html:s,title:"\u5151\u6362\u9053\u5177",width:e,height:c}),PageData.user.setpass?a._buyDialog.element.find(".buy_tpl_right").append(a.util.getFreeInfo(t)):a._buyDialog.element.find(".buy_tpl_left").append(a.util.getFreeInfo(t)),"1"==t.props_type&&a.bindCountEvent(t.scores),a._buyDialog.element.one("click",".j_confirm_buy",function(){var e={props_id:t.props_id};if("1"==t.props_type&&!a.checkCountError())return a._buyDialog.element.one("click",".j_confirm_buy",arguments.callee),void 0;"1"==t.props_type&&(e.buy_num=a._buyDialog.element.find(".j_count").val()),i>0&&$("#j_charge_checked").length&&$("#j_charge_checked")[0].checked&&(e.use_fetch_scores=$(".Tbean_num").text()),$.stats.track(t.props_id,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u786E\u5B9A\u5151\u6362");var s=function(n){n&&$.extend(e,n),a.netProxy.buyProp(e,function(n){var i="",o="",c=a.use("tbmall/widget/TbeanSafe",{json:n,sucCallback:s,content:a});if(!c.needCheck()){if(0==n.no){switch(t.props_category){case"107":o='\u5728\u8D34\u5427\u8BE6\u60C5\u9875\u70B9\u51FB<img style="vertical-align:middle;" src="/tb/static-tbmall/img/magic_show_icon.png" />\u4F7F\u7528';break;case"108":"1080001"==t.props_id&&(o="\u5728\u7B7E\u5230\u9875\u9762\u4F7F\u7528");break;case"101":o="\u4F60\u53EF\u4EE5\u5728\u8FD9\u91CC\u4F7F\u7528\u4F60\u7684\u53D1\u8D34\u6C14\u6CE1";break;case"104":o="\u5728\u53D1\u8D34\u6846\u4E2D\u4F7F\u7528";break;case"105":o="\u60A8\u5DF2\u6210\u529F\u62E5\u6709\u8BE5\u52CB\u7AE0\u5BF9\u5E94\u7684\u9053\u5177\u7279\u6743\uFF0C\u5FEB\u53BB\u4F7F\u7528\u5427\uFF01";break;case"109":case"110":o="\u5728\u5F53\u524D\u9875\u9762\u4F7F\u7528";break;case"113":o="\u5728\u4E2A\u4EBA\u4E2D\u5FC3\u4F7F\u7528"}i="1"==t.props_type?"\u5151\u6362"+e.buy_num+"\u4E2A<span class='orange_txt'>"+n.data.title+"</span>\u6210\u529F\uFF01<br>"+o:"\u5151\u6362<span class='orange_txt'>"+n.data.title+"</span>\u6210\u529F\uFF01\u6709\u6548\u671F\u81F3<span class='orange_txt'>"+a.util.formatDate(n.data.end_time)+"</span><br>"+o}else switch(n.no){case 2270005:i="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:i="\u9886\u53D6\u6210\u529F`(*\u2229_\u2229*)\u2032";break;case 2270004:i="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u5151\u6362\u672C\u52CB\u7AE0\uFF01";break;case 2270006:i="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u5151\u6362";break;case 360007:case 2150040:var l=a.use("tbmall/component/captcha_payment",{data:n});return l.showCaptcha(s),void 0;case 2270018:case 1990005:case 2190005:n.data=n.data||{};var r=a.use("tbmall/widget/paykey_dialog",{showType:2,errType:n.no,errTime:n.data.wrongtime});return r.showDialog(s,function(){},a),void 0;default:i="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}0==n.no&&($.inArray(t.props_category,["109","110","114"])>-1||"1080002"==t.props_id)?a.dialog.confirm('<div class="tip">'+i+"</div>",{button:[{txt:"\u7ACB\u5373\u4F7F\u7528",extraclass:"j_nameplate_recast1",callback:function(){a.dialog.close(),"1080002"==t.props_id?a.use("tbmall/widget/ContSignCard"):"1140001"==t.props_id?$(".j_nameplate_recast").trigger("click"):a.useController.doUse(parseInt(n.data.props_id))}},{txt:"\u7A0D\u540E\u4F7F\u7528",callback:function(){a.dialog.close(),$.tb.location.reload()}}]}):0==n.no&&$.inArray(t.props_category,["101"])>-1?(a.dialog.info('<div class="tip tip_center">'+i+'</div><div class="tip_bubble_intro"></div><div class="tip_operation"><input type="checkbox" class="tip_check_box"/>\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u6C14\u6CE1</div>',{title:"\u8D2D\u4E70\u6210\u529F",width:475,height:365,button:"\u6211\u77E5\u9053\u4E86"}),a.dialog.bind("onInfoClose",function(){$(".tip_operation .tip_check_box").tbattr("checked")?$.ajax({url:"/tbmall/submit/setBub",type:"post",dataType:"json",data:{props_id:t.props_id,tbs:PageData.tbs||PageData.user.tbs},success:function(){$.tb.location.reload()},error:function(){$.tb.location.reload()}}):$.tb.location.reload()})):(a.dialog.info('<div class="tip">'+i+"</div>"),0==n.no&&a.dialog.bind("onInfoClose",function(){$.tb.location.reload()}))}})};a._buyDialog.close(),s()})}}});_.Module.define({path:"encourage/widget/celebrity_expball",requires:["encourage/widget/util","tbmall/component/BuyController","common/widget/LoginDialog","tbmall/widget/TbeanSafeAjax","common/widget/Tdou/TdouViewPay","tbmall/widget/forumMemberDialog","common/widget/payMember"],sub:{resources:{expballPropsCategoryId:119,expballPropsId:1190001,buyprops:"/tbmall/post/buyprops",voteNpc:"/celebrity/submit/voteNpc",ApiGenOrder:"/celebrity/submit/genOrder"},initial:function(e){this.opt=e||{},this.util=this.requireInstance("encourage/widget/util"),this.parrProps=this.util.user.Parr_props||{},this.forum=this.util.pageData.forum||this.opt.forum||{},this.user=this.util.user,this.tplMain=this.util.parseTpl(' "<div class="celebrity-expball">      <div class="celebrity-expball-top">          <div class="celebrity-expball-top-left"></div>          <div class="celebrity-expball-top-right">              <h3>\u53CC\u500D\u7403\u53EF\u4EE5\u5E2E\u4F60\u7FFB\u500D\u6295\u7968\u7ECF\u9A8C\uFF01</h3>              <button class="celebrity-expball-buy-btn btn-encourage btn-large" j-celebrity-expball-buy-btn>\u53BB\u4E70\u9053\u5177</button>          </div>        </div>      <div class="celebrity-expball-bottom">          <p>\u66F4\u591A\u7FFB\u500D\u7968\u6570\u7279\u6743</p>            <p>              \u672C\u5427\u4F1A\u5458\uFF1A\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+2;              <a href="javascript:;" j-celebrity-expball-local-vip>\u5F00\u901A>> </a>          </p>            <p>              \u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\uFF1A\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+2\u3002              <a href="javascript:;" j-celebrity-expball-super-vip>\u5F00\u901A>> </a>          </p>      </div>  </div>" '),this.tplConfirm=this.util.parseTpl(' "<div class="celebrity-expball" >      <div class="celebrity-expball-vote">          <h3>\u53CC\u500D\u7403\u53EF\u4EE5\u5E2E\u4F60\u7FFB\u500D\u7968\u6570\u54E6!</h3>          <div class="celebrity-expball-vote-confirm-btn-wrapper">              <button class="btn-default celebrity-expball-vote-confirm-btn btn-middle" j-celebrity-expball-vote-use-btn>\u4F7F\u7528\u9053\u5177(\u8FD8\u5269<%=left_num %>\u4E2A)</button>              <button class="btn-sub celebrity-expball-vote-confirm-btn btn-middle"  j-celebrity-expball-vote-no-use-btn>\u76F4\u63A5\u6295\u7968</button>          </div>      </div>  <div>" '),this.tplVote=this.util.parseTpl(' "<div class="celebrity-expball">      <div class="celebrity-expball-top">          <div class="celebrity-expball-vote">              <h3><i class="celebrity-expball-vote-icon"></i>\u6295\u7968\u6210\u529F\uFF0C<span class="orange-text">\u540D\u4EBA\u7968\u6570+<%=add_vote_num %></span></h3>              <% if (left_vote_times != -1) { %>              <p class="celebrity-expball-vote-tip">\u4ECA\u65E5\u8FD8\u5269<a><%=left_vote_times %></a>\u6B21\u6295\u7968\u673A\u4F1A</p>              <% } %>          </div>        </div>      <div class="celebrity-expball-bottom">          <p>\u7FFB\u500D\u7968\u6570\u7279\u6743</p>          <ul class="celebrity-expball-bottom-list">              <li>                  <span>\u53CC\u500D\u7403</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570*2 <a href="javascript:;" j-celebrity-expball-buy-btn>\u53BB\u8D2D\u4E70>> </a></span>              </li>              <li>                  <span>\u672C\u5427\u4F1A\u5458</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+2 <a href="javascript:;" j-celebrity-expball-local-vip>\u5F00\u901A>> </a></span>              </li>          </ul>      </div>  </div>" '),this.bindEvent()},bindEvent:function(){var e=$("#celebrity"),t=this;e.on("click","[j-celebrity-vote-btn]",function(){var e=$(this);if(t.util.checkLogin(!0)){var i=e.tbattr("data-id");t.hasExpBall(t.parrProps)?(t.showVoteConfirmDialog(),t.dialog.element.on("click","[j-celebrity-expball-vote-use-btn]",function(){t.vote(i,1)}).on("click","[j-celebrity-expball-vote-no-use-btn]",function(){t.vote(i,0)})):t.vote(i,0)}}).on("click","[j-celebrity-expball-show]",function(){t.tbmallBuy(this)})},hasExpBall:function(e){return $.getPageData("119.1190001.left_num",0,e)||0},setForum:function(e,t){return this.forum=this.util.fine({forum$id:e,forum$name:t}),this},setCallback:function(e,t){this.callback=e,this.context=t},vote:function(e,t){var i=this,l=i.util.fine({id:e,use$num:t,tbs:i.util.tbs});$.post(this.resources.voteNpc,l,function(e){if(e)switch(e.no){case 0:t>0&&i.hasExpBall(i.parrProps)&&(i.parrProps["119"]["1190001"].left_num-=t),i.showVoteSuccessDialog(e.data),i.callback&&(i.context?i.callback.call(i.context,e.data):i.callback(e.data));break;case 952710:i.showAlert("\u60A8\u672A\u5173\u6CE8\u672C\u5427");break;case 11e4:i.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:i.showAlert("\u5427\u7B49\u7EA7\u8FBE\u5230"+(e.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6");break;case 952712:i.showAlert("\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~");break;case 952713:i.showAlert("\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5C06\u5728\u4E0B\u4E2A\u67081\u53F7\u65E9\u4E0A8\u70B9\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85");break;case 952724:i.showAlert("\u672C\u671F\u6295\u7968\u7ED3\u675F, \u4E0B\u671F\u6295\u7968\u5C06\u5728\u65E9\u4E0A8\u70B9\u542F\u52A8, \u656C\u8BF7\u671F\u5F85");break;case 952709:i.showAlert("\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B");break;case 65534:i.showAlert("\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5");break;case 65533:i.showAlert("\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301");break;case 65532:i.showAlert("\u5F53\u524DIP\u5DF2\u88AB\u9501\u5B9A");break;case 2160001:i.showAlert("\u89D2\u8272\u5DF2\u6EE1\u4E00\u4E07\u7968");break;default:i.showAlert("\u64CD\u4F5C\u5931\u8D25,"+e.error)}})},tbmallBuy:function(e){var t=this,i=this.util.fine({props$id:this.resources.expballPropsId,props$category:this.resources.expballPropsCategoryId,props$type:"1",scores:"200",name:"\u53CC\u500D\u7403",imgsrc:"//tb2.bdstatic.com/tb/static-encourage/widget/celebrity_expball/images/expball_buy_icon_552acff.jpg",free$user$level:"0",time$interval:"0",fetch$scores$limit:"0",is$default$usedd:"0"});this.util.pageData.scores=this.user.Parr_scores||{};var l=t.util.pageData.scores.scores_total||0;return 200>l?(t.showAlert("T\u8C46\u4F59\u989D\u4E0D\u8DB3, \u8BF7\u5148\u5151\u6362T\u8C46\u5427~"),void 0):(this.buyController=this.requireInstance("tbmall/component/BuyController",[$(e),i]),this.buyController._buyDialog.element.off("click",".j_confirm_buy").on("click",".j_confirm_buy",function(){t.genOrder(+t.buyController._buyDialog.element.find(".j_count").val())}),void 0)},genOrder:function(e){var t=this;$.post(t.resources.ApiGenOrder,t.util.fine({props$id:t.resources.expballPropsId,props$num:e,from:"pc",tbs:t.util.tbs}),function(e){0===+e.no?t.payOrder(e.data||{}):t.showAlert("\u8BA2\u5355\u751F\u6210\u5931\u8D25, \u8BF7\u7A0D\u5019\u91CD\u8BD5")})},payOrder:function(e){var t=this,i=$.extend(t.util.fine({from:"\u540D\u4EBA\u5802",chargeType:"platform",goods$unit:"\u4E2A"}),e),l=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){e.data=e.data||{},"encourage_paid"===e.command&&0===+e.data.no&&(t.updatePageData(t.util.fine(e,"data.data.order_info")||{}),t.buyController._buyDialog.close())});l.createMain(i)},updatePageData:function(e){var t=+e.tdou_num,i=+e.money_scores,l=+e.other_scores,a=t/200,o=+this.hasExpBall(this.parrProps)+a,r="user.Parr_scores.scores_total",s="user.Parr_scores.scores_money",c="user.Parr_scores.scores_other",n=this.util.fine(this.util.pageData,r)||0,u=this.util.fine(this.util.pageData,s)||0,b=this.util.fine(this.util.pageData,c)||0;this.util.fine(this.util.pageData,r,n-t),this.util.fine(this.util.pageData,s,u-i),this.util.fine(this.util.pageData,c,b-l),this.util.fine(this.util.pageData,"user.Parr_props.119.1190001.left_num",o)},showExpBallDialog:function(){var e=this;this.showDialog(this.tplMain({})),e.dialog.element.on("click","[j-celebrity-expball-buy-btn]",function(){e.dialog.close(),e.tbmallBuy(this)}).on("click","[j-celebrity-expball-local-vip]",function(){e.dialog.close();var t=e.util.fine({scores$money:0,scores$other:0});e.requireInstance("tbmall/widget/forumMemberDialog",e.util.fine({is$show$features:!1,is$show$forum:!1,current$forum$id:e.forum.forum_id,current$forum$name:e.forum.forum_name,scores:e.user.Parr_scores||t,cnt$height:225,is$celebrity$forum:!0,callback:function(){$.tb.location.reload()}}))}).on("click","[j-celebrity-expball-super-vip]",function(){e.dialog.close();var t=e.requireInstance("common/widget/payMember"),i={fr:"celebrity"};t.showCashier(i)})},showVoteSuccessDialog:function(e){var t=this;e.left_vote_times=e.left_vote_times||-1,this.showDialog(t.tplVote(e)),t.dialog.element.on("click","[j-celebrity-expball-buy-btn]",function(){t.dialog.close(),t.tbmallBuy(this)}).on("click","[j-celebrity-expball-local-vip]",function(){t.dialog.close();var e=t.util.fine({scores$money:0,scores$other:0});t.requireInstance("tbmall/widget/forumMemberDialog",t.util.fine({is$show$features:!1,is$show$forum:!1,current$forum$id:t.forum.forum_id,current$forum$name:t.forum.forum_name,scores:t.user.Parr_scores||e,cnt$height:225,is$celebrity$forum:!0,callback:function(){$.tb.location.reload()}}))}).on("click","[j-celebrity-expball-super-vip]",function(){t.dialog.close();var e=t.requireInstance("common/widget/payMember"),i={fr:"celebrity"};e.showCashier(i)})},showVoteConfirmDialog:function(){this.showDialog(this.tplConfirm(this.util.fine({left$num:this.hasExpBall(this.parrProps)})))},showAlert:function(e){$.dialog.alert(e,{title:"\u8D34\u5427\u63D0\u793A",acceptValue:"\u77E5\u9053\u5566",onaccept:function(){return!0}})},showDialog:function(e,t){this.dialog&&(this.dialog.close(),this.dialog=null),this.dialog=new this.util.Dialog({title:t,html:e,width:430})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"puser/widget/celebrity",requires:["pcommon/widget/Tdou/TdouViewPay","tbmall/widget/forumMemberDialog","encourage/widget/npc_vote/npc_vote_action","tbmall/widget/exp_package_dialog","puser/widget/celebrity_forum_dialog"],sub:{initial:function(e){this.$root=$("#celebrity"),this.forum=PageData.forum,this.user=PageData.user,this.opt=e,this.isCelebrityForum=e.isCelebrityForum||!1,this.isCurForumMember=e.isCurForumMember||!1,this._bindEvents()},purchaseExp:function(e){var o=this,r={open_id:e.open_id,order_id:e.order_id,timestamp:e.timestamp,scene_id:e.scene_id,pay_type:e.pay_type,from:"\u5355\u5427\u4F1A\u5458\u7ECF\u9A8C\u4E66",goods_name:e.goods_name,goods_image:e.goods_image||"",goods_price:e.goods_price,goods_amount:e.goods_amount,goods_unit:"\u4E2A",goods_duration:e.goods_duration,free_vip_level:e.free_vip_level,tdou_num:e.tdou_num};$.extend(r,{chargeType:"platform"}),o.payment=o.requireInstance("pcommon/widget/Tdou/TdouViewPay",function(e){"encourage_paid"!=e.command||"success"!=$.getPageData("data.error","error",e)}),o.payment.createMain(r)},_bindEvents:function(){var e=this;this.$root.find(".j-gift-buy").on("click",function(){var o={scores_money:0,scores_other:0};e.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:e.forum.forum_id,current_forum_name:e.forum.forum_name,scores:e.user.Parr_scores?e.user.Parr_scores:o,cnt_height:225,is_celebrity_forum:e.isCelebrityForum,isCurForumMember:e.isCurForumMember,callback:function(){$.tb.location.reload()}})}),this.$root.on("click",".open-btn",function(){e.$root.find(".first-show-container").hide(),e.$root.find(".second-show-container").show()}),this.$root.on("click",".close-btn",function(){e.$root.find(".first-show-container").show(),e.$root.find(".second-show-container").hide()}),this.requireInstance("encourage/widget/npc_vote/npc_vote_action",{$root:e.$root}),this.$root.on("click",".celebrity-purchase-exp",function(){if(!$.getPageData("user.is_login",0))return e.requireInstanceAsync("pcommon/widget/LoginDialog",["","userBar"]),void 0;var o={scores_money:0,scores_other:0};e.requireInstance("tbmall/widget/exp_package_dialog",[{is_show_features:!1,is_show_forum:!1,current_forum_id:e.forum.id,current_forum_name:e.forum.name,scores:e.user.Parr_scores?e.user.Parr_scores:o,cnt_height:225,is_celebrity_forum:e.isCelebrityForum,isCurForumMember:e.isCurForumMember,callback:function(){$.tb.location.reload()}}])}),this.requireInstance("puser/widget/celebrity_forum_dialog",{$root:e.$root.find(".j-btn-celebrity"),celebrity:e.opt.celebrity,memberLastDays:e.opt.memberLastDays})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"pcommon/widget/Tdou/TdouViewPay",requires:["pcommon/widget/Tdou/TdouBuilder","pcommon/widget/Tdou/TdouData","pcommon/widget/Tdou/TdouViewUtil","pcommon/widget/Tdou/TdouViewAutoRedirect","pcommon/widget/Tdou/TdouViewOperationBootstrap","pcommon/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("pcommon/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("pcommon/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("pcommon/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("pcommon/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this,o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("pcommon/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("pcommon/widget/payMember"),t={fr:"open_super_member_link"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("pcommon/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"encourage/widget/npc_vote/npc_vote_action",sub:{initial:function(e){this._opt=e,this._bindEvents()},_bindEvents:function(){var e=this,t=this._opt.$root;t.on("click",".j-btn-vote",function(){if(!PageData.user.is_login)return e.requireInstanceAsync("common/widget/LoginDialog"),void 0;var a=$(this).data("id"),n=$(this).data("forumname");$.post("/celebrity/submit/voteNpc",{tbs:PageData.tbs,id:a},function(a){switch(a.no){case 0:t.find(".j_vote_npc_"+a.data.id).find(".j_vote_num").text(a.data.vote_num),e._success();break;case 952710:e._attention(n);break;case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:e._alert({msg:"\u5427\u7B49\u7EA7\u8FBE\u5230"+(a.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6"});break;case 952712:e._alert({msg:"\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~"});break;case 952713:e._alert({msg:"\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5373\u5C06\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85"});break;case 952709:e._alert({msg:"\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B"});break;case 65534:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5"});break;case 65533:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301"});break;case 65532:e._alert({msg:"IP\u4E00\u5929\u8D85\u8FC7500"});break;default:$.dialog.alert(a.error,{title:"\u63D0\u793A"})}})})},_success:function(){var e='<div class="npc-vote-dialog"><p>\u6295\u7968\u6210\u529F</p><div class="btn-group"><a href="/celebrity/rankHome#npc_vote" class="btn-default btn-small mr10 j-see-rank">\u67E5\u770B\u699C\u5355</a> <a href="javascript:;" class="btn-sub btn-small j_close">\u53D6 \u6D88</a></div></div>',t=this._alert({html:e});$(t.element).find(".j-see-rank").on("click",function(){t.close()})},_alert:function(e){var t=e.html||'<div class="npc-vote-dialog"><p>'+e.msg+'</p><div class="btn-group">  <a href="#" class="btn-default btn-small j_close">\u786E \u8BA4</a></div></div>',a=new $.dialog({width:380,html:t,title:"\u63D0\u793A",draggable:!1});return $(a.element).find(".j_close").on("click",function(){return a.close(),!1}),a},_attention:function(e){var t='<div class="npc-vote-dialog"><p>\u672A\u5173\u6CE8\u672C\u5427\u4E0D\u80FD\u6295\u7968\u54E6~</p><div class="btn-group"> <a href="/f?kw='+encodeURIComponent(e)+'" class="btn-default btn-small">\u53BB\u5173\u6CE8</a></div></div>';new $.dialog({width:350,html:t,title:"\u63D0\u793A",draggable:!1})}}});_.Module.define({path:"pcommon/widget/payment_dialog_title",requires:["pcommon/widget/base_user_data","user/widget/icons"],sub:{initial:function(e){var s=this,t={title:"",isNameShow:!1,isTdouShow:!1,isMemberShow:!1,onClose:$.noop};s.opts=$.extend(t,e),s.$container=e.$container,s.baseUserData=s.requireInstance("pcommon/widget/base_user_data"),s.userIcon=s.requireInstance("user/widget/icons"),s.rendTitle(),s.bindEvents()},getMemberIcon:function(){var e=window.PageData.user,s=this.userIcon.getPreIconHtml($.getPageData("mParr_props",{},e),e,!0);return s},getIsMember:function(){var e=this.baseUserData.getMemberIcon().icon,s="";return("ordinary_member_icon"==$.trim(e)||"super_member_icon"==$.trim(e)||e.indexOf("vip1-18")>0||e.indexOf("vip2-18")>0)&&(s=" member-red "),s},getUserName:function(){var e=this.baseUserData.getUserName()||"";return{name:e,formateName:e.length>8?e.slice(0,8)+"...":e}},getUserTdou:function(){return this.baseUserData.getUserTdou()||0},getTreasureNum:function(){return this.baseUserData.getUserTreasure()||0},rendTitle:function(){var e=this,s=e.opts,t=_.template('<div class="payment-dialog-title">         <h4 class="payment-dialog-title-txt"><%=title%></h4>     <div class="payment-dialog-title-user">         <%if(isNameShow){%>         <div class="user-name">             \u5E10\u53F7\uFF1A<%=memberIcon%><span title="<%=userName[\'name\']%>" class="orange-txt <%=memberClass%>"><%=userName[\'formateName\']%></span>         </div>         <%}%>         <%if(isTdouShow){%>         <div class="user-tdou">             T\u8C46\u4F59\u989D\uFF1A<i class="icon-tbean"></i><span class="orange-txt"><%=userTdouNum%></span>         </div>         <%}%>         <%if(isMemberShow){%>         <div class="user-member">         </div>         <%}%>         <%if(isTreasureShow){%>         <div class="user-treasure">             \u593A\u5B9D\u5E01\uFF1A<span class="orange-txt"><%=userTreasureNum%></span>         </div>         <%}%>     </div>     <a href="javascript:;" class="payment-dialog-title-close j-payment-close"></a> </div>')({title:s.title||"",isNameShow:s.isNameShow,isTdouShow:s.isTdouShow,isMemberShow:s.isMemberShow,isTreasureShow:s.isTreasureShow,memberClass:e.getIsMember(),userName:e.getUserName(),userTdouNum:e.getUserTdou(),memberIcon:e.getMemberIcon(),userTreasureNum:e.getTreasureNum()});e.$container&&e.$container.html(t)},bindEvents:function(){var e=this;e.$container.on("click",".j-payment-close",function(){e.opts.onClose()})}}});_.Module.define({path:"pcommon/widget/show_dialog",sub:{initial:function(t){var e=this;e.container=t.container,e.$container=e.container.element,e.type=t.type,e.top=parseInt(e.$container.css("top"),10),e.height=e.$container.outerHeight()},show:function(){var t=this,e="show";switch(t.type){case"top-pop":t.topPop(e);break;case"bigger":t.biggerShow(e);break;default:t.showDefault(e)}},close:function(){var t=this,e="close";switch(t.type){case"top-pop":t.topPop(e);break;case"bigger":t.biggerShow(e);break;default:t.showDefault(e)}},getOriginSize:function(){var t=$(".dialogJ");if($.isEmptyObject(t))return{width:0,height:0};var e=t.eq(t.length-2);return{width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}},getEndSize:function(){return{width:this.$container.outerWidth(),height:this.$container.outerHeight(),top:this.$container.css("top"),left:this.$container.css("left")}},biggerShow:function(t){var e=this,i=e.getOriginSize(),o=e.getEndSize();"show"===t?(e.$container.css({width:i.width,height:i.height,top:i.top,left:i.left}),e.container.show(),e.$container.animate({width:o.width,height:o.height,top:o.top,left:o.left})):e.$container.animate({width:i.width,height:i.height,top:i.top,left:i.left},function(){e.container.close()})},topPop:function(t){var e=this;"show"===t?(e.$container.css({top:-(e.top+e.height)}),e.container.show(),e.$container.animate({top:e.top})):e.$container.animate({top:-(e.top+e.height)},function(){e.container.close()})},showDefault:function(t){var e=this;"show"===t?e.container.show():e.container.close()}}});_.Module.define({path:"pcommon/widget/qianbaoPurchaseTdou",requires:["pcommon/widget/qianbaoCashierDialog","pcommon/widget/baseUserData","pcommon/widget/baseDialogUserBar"],sub:{$root:null,tryOptions:null,payOptions:null,initial:function(){var a=this;a.cashierDialog=a.requireInstance("pcommon/widget/qianbaoCashierDialog"),a.baseData=a.requireInstance("pcommon/widget/baseUserData"),a.baseDialogUserBar=this.requireInstance("pcommon/widget/baseDialogUserBar"),a.cashierDialog.bind("event_tdou_qianbao_pay_again",a.payAgain,a)},payAgain:function(){var a=this;a._buy_icon_ajax&&a._buy_icon_ajax.abort(),a._buy_icon_ajax=$.ajax({type:"get",url:"/tbmall/getPayUrl",data:a.tryOptions,cache:!1,dataType:"json"}).success(function(e){if(e&&1990055===e.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var o="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),i="https://passport";$.JsLoadManager.use([i+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(o/6e4),i+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(o/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else{var n=e.data;a.payOptions.qianbao_params=n.return_url,a.payOptions.iconCount=n.iconCount,a.payOptions.iconId=n.iconId,a.showDialog(a.payOptions,a.tryOptions)}})},showDialog:function(a,e){var o=this;o.tryOptions=e,o.payOptions=a,o.product=a.product||"tdou";var i=a.iconId||"suiji",n=a.iconCount||1,s={};o.getIconInfo(function(e){var t=e.data;for(var c in t)t[c].iconId==i&&(s={iconId:i,iconCount:n,iconImg:t[c].picUrl,memeberTdou:parseInt(1.05*n*t[c].non_member_t),tdou:n*t[c].non_member_t,name:t[c].name,qianbao_params:a.qianbao_params},s.pay_tdou=2==o.baseData.getMemberLevel()?s.memeberTdou:s.tdou);o.showIcon(s)},o)},showIcon:function(a){var e=this,o=a.qianbao_params||"",i=$.extend(a,{baseDialogUserBarTpl:e.baseDialogUserBar.getUserBarTemplate(),isSuperMember:2==e.baseData.getMemberIcon().level?!0:!1}),n=_.template('<div class="qianbao_cashier_purchase_tdou ">     <%=baseDialogUserBarTpl%>     <div class="qianbao_cashier_goods">         <div class="order_info clearfix" style="display: block;">             <label class="title order_label">\u5546\u54C1\u8BA2\u5355\uFF1A</label>             <section class="order_desc clearfix">                 \u672C\u6B21\u83B7\u53D6<i class="icon-tbean"></i><span class="tdou_num"><%=pay_tdou%></span>\uFF0C\u9700\u8981\u8D2D\u4E70\u4EE5\u4E0B\u5370\u8BB0\u6765\u5B8C\u6210             </section>         </div>         <div class="goods_list">             <label class="title goods_title">\u8D2D\u4E70\u5546\u54C1\uFF1A</label>              <div class="icon_item">                 <div class="icon_desc">                     <%if(isSuperMember) {%>                         <p>\u8D85\u7EA7\u4F1A\u5458\u83B7\u8D60<i class="icon-tbean"></i><span class="orange-txt"><%=memeberTdou%></span></p>                     <%} else {%>                         <p>\u975E\u8D85\u7EA7\u4F1A\u5458\u83B7\u8D60<i class="icon-tbean"></i><span class="orange-txt"><%=tdou%></span></p>                     <%}%>                 </div>                 <div class="icon_img_box">                     <div class="icon_info" data-id="<%=iconId%>" data-price="1000" data-amount="110000">                         <img class="icon_img" src="<%=iconImg%>">                         <p class="tdou_text"><%=name%><span id="iconCount"><%=iconCount%></span>\u4E2A<span class="expire_date">\uFF08\u6709\u6548\u671F\uFF1A<span class="day"><%=iconCount%></span>\u5929\uFF09</span></p>                     </div>                 </div>             </div>             <%if(!isSuperMember) {%>                 <p class="super-member-tips"><i class="icon-crown-super-vip"></i>\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\u52A0\u9001<span class="orange-txt">5%</span>\uFF0C\u83B7\u8D60<i class="icon-tbean"></i><span class="orange-txt"><%=memeberTdou%></span></p>             <%}%>         </div>     </div> </div> ')(i),s={qianbao_params:o,product:e.product};e.cashierDialog.showDialog(s,n,function(a){e.$root=a,e.bindEvents()})},bindEvents:function(){var a=this;a.$root.find(".j_header_close").on("click",function(){a.cashierDialog.closeDialog()}),a.$root.find(".qianbao_cashier_agreement a").on("click",function(a){a.stopPropagation(),$.stats.track("\u4ED8\u6B3E\u5F39\u7A97\u5E95\u90E8","\u83B7\u53D6T\u8C46\u4F1A\u5458\u670D\u52A1\u534F\u8BAE\u70B9\u51FB",PageData.page?PageData.page:"other","click")})},getIconInfo:function(a,e){var o=this,i={ie:"utf-8"};i.tbs=PageData.tbs,o._get_icon_ajax&&o._get_icon_ajax.abort(),o._get_icon_ajax=$.ajax({type:"get",url:"/tbmall/gettdouiconinfo",data:i,cache:!1,dataType:"json"}).success(function(o){a.call(e,o)})}}});_.Module.define({path:"pcommon/widget/tdou_get",requires:["pcommon/widget/base_user_data","pcommon/widget/payment_dialog_title","pcommon/widget/show_dialog","pcommon/widget/tdou/tdou_data","pcommon/widget/qianbao_purchase_tdou"],sub:{tdouOptionsHeight:71,payChannel:2,URL:{getTdouIconInfo:"/tbmall/gettdouiconinfo"},iconInfoList:[],orderNum:0,iconId:"",initial:function(t){var e=this;e.opts=t,e.initDialog(),e.isPlus=window.PageData.user.id%2?!0:!1,e.baseUserData=e.requireInstance("pcommon/widget/base_user_data"),e.dataProxy=e.requireInstance("pcommon/widget/tdou/tdou_data",{scores:e.baseUserData.getUserTdou(),level:e.baseUserData.getMemberIcon().level}),e.getUserMember(),e.getTdouIconInfo(function(){e.renderContainer(),e.bindEvents(),e.defaultSelect(),e.clearLoading()})},defaultSelect:function(){this.$dialog.find(".tdou-options").eq(1).click(),this.$tdouSelectView.show(),this.orderNumCtrl("add")},getUserMember:function(){var t=this.baseUserData.getMemberIcon();this.isSuperMember=2==t.level?!0:!1},getTdouIconInfo:function(t){var e=this,i={tbs:window.PageData.tbs,ie:"utf-8"};$.get(e.URL.getTdouIconInfo,i,function(i){0==i.no?(e.formateIconData(i.data),t&&t()):e.errorTips("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u5019\u91CD\u8BD5")})},formateIconData:function(t){this.iconInfoList=[t.tbxiaotietie,t.ff14,t.tbzhangyu,t.tbxiaoxiong]},errorTips:function(t){console.log(t)},initDialog:function(){var t=this;$(".tdou-get-dialog").length&&$(".tdou-get-dialog").remove(),t.dialog=new $.dialog({html:_.template('<div class="tdou-get-dialog-container">     <section class="tdou-get-dialog-container-loading">         <img src="<%=url%>" class="loading-img">         <p>\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>     </section> </div>')({url:"http://tb2.bdstatic.com/tb/static-pcommon/widget/tdou_get/images/icon-loading_f0da091.gif"}),show:!1,holderClassName:"tdou-get-dialog",escable:!1,showTitle:!1,height:500,width:620}),t.$dialog=t.dialog.element,t.dialogCtrl=t.requireInstance("pcommon/widget/show_dialog",{container:t.dialog,type:"top-pop"}),t.dialogCtrl.show()},renderContainer:function(){var t=this,e=_.template('<section class="tdou-get-dialog-container-title"> </section> <section class="tdou-get-dialog-container-selection <%=isPlus%>">     <p class="tdou-get-dialog-container-selection-tips">\u83B7\u53D6T\u8C46\uFF0C\u9700\u8981\u8D2D\u4E70\u4EE5\u4E0B\u5370\u8BB0\u6765\u5B8C\u6210</p>     <ul class="tdou-selection-list">         <%              var top = -73;             var left = -142;             for(var i in list) {             var item = list[i];             top += 71;             left += 140;                          var tbmall_price = item[\'non_member_t\'] / 1000;             var given_tdou = item[\'non_member_t\'] * 0.05;         %>          <li class="tdou-options j-tdou-select" id="<%=item[\'iconId\']%>" data-top="<%=top%>" data-left="<%=left%>" data-icon={"num":"<%=item[\'non_member_t\']%>","price":"<%=tbmall_price%>"}>             <div class="price-div">                 <span class="price-name">                     <span class="price-title">\u4EF7\u683C:</span><span class="price"><%=tbmall_price%></span>\u5143                 </span>                              </div>             <div class="info-div">                 <div class="tdou-info">                     \u8D60\u9001<i class="icon-tbean"></i><span class="tdou-num orange-txt"><%=item[\'non_member_t\']%></span>                 </div>                 <div class="member-info">                     <i class="icon-crown-super-vip"></i>                     <p class="member-info-div j-get-member">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\u52A0\u9001<span class="orange-txt">5%</span></p>                     <span class="member-info-div"><i class="orange-txt"><%=given_tdou%></i>T\u8C46</span>                     <p class="member-info-div-plus j-get-member">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458<span class="orange-txt">+<%=given_tdou%></span></p>                 </div>             </div>             <div class="icon-div">                 <div class="icon-img">                     <img src="<%=item[\'picUrl\']%>" />                 </div>                 <div class="icon-txt">                     <p><%=item[\'name\']%></p>                     <p>\u6709\u6548\u671F\uFF1A<%=item[\'duration\']%>\u5929</p>                 </div>             </div>         </li>         <%}%>         <li class="tdou-options-active">             <i class="icon-select"></i>         </li>     </ul> </section> <section class="tdou-get-dialog-container-order">     <div>         <span class="payment-txt">\u8D2D\u4E70\u6570\u91CF\uFF1A</span>         <div class="tdou-num-ctrl">             <a href="javascript:;" class="tdou-num min j-change-num" data-type="min">-</a><input class="tdou-num-input j-input-num" data-type="input" type="text" maxlength="6"/><a href="javascript:;" class="tdou-num add j-change-num" data-type="add">+</a>         </div>         <div class="cash-num-view">             \u9700\u652F\u4ED8\uFF1A<span class="cash-num-view-txt orange-txt">0</span>\u5143         </div>         <div class="tdou-num-view">             \u83B7\u8D60\uFF1A<span class="tdou-num-view-txt orange-txt">0</span>T\u8C46         </div>     </div> </section> <section class="tdou-get-dialog-container-btn">     <a href="javascript:;" class="payment-btn j-get-tdou">\u7ACB\u5373\u652F\u4ED8</a> </section> <section class="tdou-get-dialog-container-bottom">     \u63D0\u9192\uFF1A\u60A8\u5728PC\u4EE5\u53CA\u5B89\u5353\u624B\u673A\u4E0A\u83B7\u53D6\u7684T\u8C46\u4E0EIOS\u624B\u673A\u4E0A\u83B7\u53D6\u7684T\u8C46\u4E0D\u540C\u7528 </section>')({list:t.iconInfoList,isPlus:t.isPlus?"dialog-plus":""});t.$dialog.find(".tdou-get-dialog-container").append(e),t.$dialogTitle=t.$dialog.find(".tdou-get-dialog-container-title"),t.$tdouSelectView=t.$dialog.find(".tdou-options-active"),t.$cashView=t.$dialog.find(".cash-num-view-txt"),t.$tdouNumView=t.$dialog.find(".tdou-num-view-txt"),t.$orderInput=t.$dialog.find(".tdou-num-input"),t.$minOrderBtn=t.$dialog.find(".j-change-num").eq(0),t.$loadingView=t.$dialog.find(".tdou-get-dialog-container-loading"),t.$getTouBtn=t.$dialog.find(".j-get-tdou"),t.addTitle(),t.trackCtrl("view")},addTitle:function(){var t=this,e={$container:t.$dialogTitle,title:"\u83B7\u53D6T\u8C46",isNameShow:!0,isTdouShow:!0,onClose:function(){t.dialogCtrl.close()}};t.requireInstance("pcommon/widget/payment_dialog_title",e)},changeTdouOptions:function(t){var e=t.tbattr("id"),i=Number(t.data("top")),o=Number(t.data("left")),a=this.$tdouSelectView;this.iconData=t.data("icon"),this.isPlus?a.animate({left:o},"fast","swing"):a.animate({top:i},"fast","swing"),this.iconId=e,this.orderViewUpdate()},orderNumCtrl:function(t){var e=this,i=e.orderNum;"add"===t?e.$orderInput.val(++i):e.$orderInput.val(--i),1==i?e.$minOrderBtn.addClass("disabled"):e.$minOrderBtn.removeClass("disabled"),e.orderNum=i,e.orderViewUpdate()},orderInputNumCtrl:function(t){var e=this,i=t.val(),o=parseInt(i,10)||0;""===i?(e.orderNum=0,e.$minOrderBtn.addClass("disabled")):0===o?(e.orderNum=0,e.$minOrderBtn.addClass("disabled"),e.$orderInput.val("")):(1!==o&&e.$minOrderBtn.removeClass("disabled"),i!=o?(e.orderNum=o,e.$orderInput.val(o)):e.orderNum=o),e.orderViewUpdate()},orderViewUpdate:function(){var t=this;if(t.orderNum&&t.iconId){var e=t.iconData,i=t.orderNum,o=Number(e.price)*i,a=Number(e.num)*i;t.isSuperMember&&(a+=.05*a),t.$cashView.html(o),t.$tdouNumView.html(a)}else t.$cashView.html(0),t.$tdouNumView.html(0)},getTdou:function(){var t=this,e=$.tb.location.getHref();t.setLoading();var i=t.opts&&t.opts.consumption_path||0;t.dataProxy.payIcon(t.iconId,t.orderNum,t.buyIcon,t,e,i,t.payChannel)},buyIcon:function(t){var e=this;if(t&&0==t.no){e.cashier=e.requireInstance("pcommon/widget/qianbao_purchase_tdou");var i=t.data,o=e.$tdouNumView.html(),a=e.opts&&e.opts.consumption_path||0,n=$.extend({product:"tdou",consumption_path:a,goods_cost_tdou:o,pay_type:6,pay_channel:e.payChannel},{qianbao_params:i.return_url,iconCount:i.iconCount,iconId:i.iconId}),s={ie:"utf-8",tbs:window.PageData.tbs,terminal:"pc",pay_type:6,iconId:i.iconId,pageUrl:i.return_url||"",margin:o,goodsCost:o,fr:a||0,channel:e.payChannel};e.cashier.showDialog(n,s),setTimeout(function(){e.clearLoading()},1e3)}else if(t&&11e4===t.no)e.requireInstance("pcommon/widget/login_dialog");else if(t&&1990055===t.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var d="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),r="https://passport";$.JsLoadManager.use([r+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(d/6e4),r+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(d/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else setTimeout(function(){e.clearLoading()},1e3)},updateTdou:function(t){console.log(t)},clearLoading:function(){var t=this;t.$loadingView.hide(),t.$getTouBtn.removeClass("loading")},setLoading:function(){this.$loadingView.show(),this.$getTouBtn.addClass("loading")},bindEvents:function(){var t=this;t.$dialog.on("click",".j-tdou-select",function(e){var i=$(e.currentTarget);t.changeTdouOptions(i),t.trackCtrl("choose")}).on("click",".j-change-num",function(e){var i=$(e.target),o=i.data("type");t.orderNumCtrl(o)}).on("input",".j-input-num",function(e){var i=$(e.target);t.orderInputNumCtrl(i)}).on("click",".j-get-tdou",function(e){var i=$(e.target);i.hasClass("loading")||(t.getTdou(),t.dialogCtrl.close(),t.trackCtrl("pay"))}).on("click",".j-get-member",function(){$.stats.track("T\u8C46\u94B1\u5305","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"\u83B7\u53D6T\u8C46\u70B9\u51FB\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"})})},trackCtrl:function(t){var e=this,i=e.isPlus?"new":"old";switch(t){case"view":$.stats.track("show-"+i,"TdouCashier","","view",{tdouViewType:i});break;case"choose":$.stats.track("choose-"+i,"TdouCashier","","click",{tdouViewType:i});break;case"pay":$.stats.track("buy-"+i,"TdouCashier","","click",{tdouViewType:i})}}}});_.Module.define({requires:["pcommon/widget/tdou_get"],path:"pcommon/widget/tchargeDialog",sub:{initial:function(e){var t=this;t.requireInstanceAsync("pcommon/widget/Tdou",[],function(c){e&&e.chargeType&&"platform"==e.chargeType?c.factory("payment",e):(e&&(t.consumption_path=e.consumption_path,t.desc=e.desc,t.current_need_tdou=e.current_need_tdou,t.is_direct_cashier=e.is_direct_cashier),e&&t.is_direct_cashier?c.factory("auto_direct",e):t.requireInstance("pcommon/widget/tdou_get",e))})}}});_.Module.define({path:"puser/widget/LikeTip",sub:{initial:function(e,s,i){var t=this,a="http://tb2.bdstatic.com/tb/static-puser/widget/like_tip/img/like_back_58420c2.png";if(i&&i.like_no&&i.like_no>=1){var r=$.dialog.alert('<img src="'+a+'" alt="\u6B22\u8FCE\u56DE\u6765" />',{width:320,height:131,acceptValue:"\u77E5\u9053\u4E86"});$(r.element[0]).find(".dialogJcontent").css("padding-bottom","0px"),$(r.element[0]).find(".dialogJanswers").css("padding-top","0px"),r.bind("onaccept",function(){t.reloadAndGotop()}).bind("onclose",function(){t.reloadAndGotop()})}else{var l=this.getTipContent(e,s,i),n={title:"\u6210\u529F\u63D0\u793A",width:418,modal:!e};this.isSuperMember()&&(n.width=535);var r=$.dialog.open(l,n);e&&$(r.element[0]).css("padding","2px"),$(r.element[0]).find(".dialogJcontent").tbattr("id","balv_first_like_dialog"),$(r.element[0]).find(".userlike_tip_span a").click(function(){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=entryimallinpop")}),$(r.element[0]).find(".lvlup_pop_btn").eq(0).bind("click",function(){t.reloadAndGotop()}),$(r.element[0]).on("click",".userlike_supermember_btn",function(){window.open("/tbmall/mall/forumMember"),t.reloadAndGotop()}),r.bind("onclose",function(){t.reloadAndGotop()})}},getTipContent:function(e,s,i){var t=PageData,a=t.user.level_id?t.user:t.user.balv,r="<span>";e&&(r+=e+"\uFF0C"),r+="\u606D\u559C\u4F60\u6210\u4E3A\u672C\u5427\u7B2C</span>",r+="<span class='tip_font_orange'>"+i.index+"</span>",r+="<span>\u4F4D\u4F1A\u5458</span>";var l="";l+='<div class="userlike_tip_join" id="userlike_tip_join">',l+='<div class="userlike_tip_info" id="userlike_tip_info">'+r+"</div>",e?l+='<div class="user_rights_msg"><span class="user_rights_msg_gray">\u83B7\u5F97\u5934\u8854&nbsp;</span><img class="user_rights_msg_img" src="/tb/static-frs/img/balv/lv_join.png">&nbsp;'+a.level_name+'<span class="user_rights_msg_gray">&nbsp;\u5347\u7EA7\u4EAB\u7279\u6743\uFF0C<span><a class="user_rights_msg_link" target="_blank" href="/f/like/level?kw='+t.forum.name_url+'">\u67E5\u770B\u4F1A\u5458\u6743\u5229</a></div>':1==a.level_id?l+='<div class="user_rights_msg">\u83B7\u5F97\u5934\u8854&nbsp;<img class="user_rights_msg_img" src="/tb/static-frs/img/balv/lv_join.png">&nbsp;'+a.level_name+'\uFF0C\u5347\u7EA7\u4EAB\u7279\u6743\uFF0C<a target="_blank" href="/f/like/level?kw='+t.forum.name_url+'">\u67E5\u770B\u5347\u7EA7\u79D8\u7C4D</a></div>':(l+='<div class="user_rights_msg">\u6839\u636E\u4F60\u5728\u672C\u5427\u7684\u6D3B\u8DC3\u8868\u73B0\uFF0C\u76F4\u63A5\u6388\u4E88<img src="http://tb2.bdstatic.com/tb/static-member/img/badges/'+a.level_id+'.png">&nbsp;'+a.level_name+"\uFF0C\u7ED9\u529B\uFF01</div>",l+='<div class="userlike_tip_span">\u672C\u5427\u767E\u5B9D\u7BB1\u5BF9\u4F60\u5F00\u653E\u4E86\uFF0C<a target="_blank" href="/imall/mall?kw='+t.forum.name_url+'">\u53BB\u767E\u5B9D\u7BB1\u770B\u770B\u6709\u54EA\u4E9B\u7279\u6743\u548C\u5B9D\u8D1D</a></div>'),this.isSuperMember()&&(l+=this.getSuperMemberHtml()),l+='<div class="lvlup_tip_btnzone">';var n="";return this.isSuperMember()&&(l+='<input class="userlike_supermember_btn userlike_sm_btn_style" type="button" value="\u8BE6\u7EC6\u4E86\u89E3\u7279\u6743"/>',n="userlike_sm_btn_style"),l+='<input class="lvlup_pop_btn '+n+'" type="button" value="\u77E5\u9053\u4E86"/>',e&&(l+='<a class="userlike_tip_cancel" target="_blank" href="/home/forum?id='+t.user.portrait+"&fr="+t.product+'">\u5982\u4F55\u53D6\u6D88\u4F1A\u5458</a>'),l+="</div></div>"},reloadAndGotop:function(){$.tb.location.setHref($.tb.location.getHref().split("#")[0])},getSuperMemberHtml:function(){var e=[],s=PageData.user?PageData.user.Parr_props?PageData.user.Parr_props.level?PageData.user.Parr_props.level:{}:{}:{},i=PageData.forum.name||PageData.forum.forum_name;return e.push('<div class="userlike_supermember">'),e.push('<div class="userlike_sm_up clearfix">'),e.push('<div class="userlike_sm_up_gift"></div>'),e.push('<div class="userlike_sm_up_info">'),e.push('<h3>\u5C0A\u8D35\u7684<span class="userlike_sm_up_icon">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458</span></h3>'),e.push("<h2>\u60A8\u5DF2\u6210\u529F\u83B7\u5F97<b>\u3010"+i+"\u5427\u7279\u6743\u5305\u3011</b></h2>"),e.push("<p>\u6709\u6548\u671F\u81F3"+this.getFormatZhTime(1e3*s.end_time)+"</p>"),e.push("</div>"),e.push("</div>"),e.push('<div class="userlike_sm_down clearfix">'),e.push('<div class="userlike_sm_down_item">'),e.push('<div class="userlike_sm_down_title">\u7EA2\u8272\u6807\u9898</div>'),e.push('<div class="userlike_sm_down_pic userlike_sm_down_pic_1"></div>'),e.push("</div>"),e.push('<div class="userlike_sm_down_item">'),e.push('<div class="userlike_sm_down_title">\u7ECF\u9A8C\u52A0\u901F</div>'),e.push('<div class="userlike_sm_down_pic userlike_sm_down_pic_2"></div>'),e.push("</div>"),e.push("</div>"),e.push("</div>"),e.join("")},isSuperMember:function(){var e=PageUnit.load("like_tip_svip_black_list");if(e)return!1;var s=PageData.user?PageData.user.Parr_props?PageData.user.Parr_props.level?PageData.user.Parr_props.level:{}:{}:{};return 1e3*s.end_time>1*new Date&&2===s.props_id&&!PageData.forum.is_star},getFormatZhTime:function(e){return"number"!=typeof e?"":(e=new Date(e),[e.getFullYear()+"\u5E74",parseInt(e.getMonth()+1)+"\u6708",e.getDate()+"\u65E5"].join(""))}}});_.Module.define({path:"puser/widget/myCurrentForum",requires:["tbmall/widget/forumMemberDialog"],sub:{initial:function(){this.user=PageData.user,this.forum=PageData.forum,this.bindEvents()},bindEvents:function(){$(".user_level .badge, .user_level .badge_block").bind("click",function(){return window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_intro"),!1}),$(".user_level .exp_bar").bind("click",function(){return window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_who"),!1})}}});_.Module.define({path:"puser/widget/tbSpam",requires:[],sub:{initial:function(){$("body").append($("#tb_spam_notice_html").html())}}});_.Module.define({path:"puser/widget/myTieba",requires:["pcommon/widget/wallet_dialog","pcommon/widget/Card","pcommon/widget/tcharge_dialog"],sub:{config:{url:{dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete",closetip:"/f/like/commit/notice/delete"}},initial:function(e){var i=this,t=e||{};i.user=PageData.user,i.forum=PageData.forum,i.balvInfo=t.balvInfo,i.style=t.style||"",i.isBySys=t.isBySys||!0,i.scoreTip=null,i.daysTofree=0,i.block_bubble=null,i.product=t.product||null},init:function(){var e=this;e.user.forbidden?e.daysTofree=e.user.forbidden.days_to_free:e.user.balv&&(e.daysTofree=e.user.balv.days_tofree),-1!=$.inArray(e.product,["frs","pb"])&&(_.Module.use("ueglibs/widget/Ban",[],function(i){e.BanLib=i}),this.user.is_login&&e.showOfflineCard()),this.user.is_login&&(this.bindEvents(),$(".user_profile .sign_highlight").length>0&&this.show_orange_tip(),this.showNewpropsTip()),this.dolikeEvent()},showOfflineCard:function(){var e=this,i=1*new Date;i>1408032e6||$.tb.Storage.get("balv_tdou_update")>i||(this.offline_card=this.use("pcommon/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="http://tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"left",card_css:{width:172,"z-index":1010,left:198,top:9},arrow_pos:{left:-7,top:20},wrap:$(".user_profile"),card_leave_display:!0}),this.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("balv_tdou_update",i+864e5),e.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("balv_tdou_update",i+864e5),e.offline_card._j_card.remove()}),this.offline_card.showCard())},bindEvents:function(){var e=this;$("#user_info").on("click",".j_score_num",function(i){i.preventDefault(),e.getInstance("pcommon/widget/wallet_dialog").show()}),$(".userliked_ban_content").on("click.bawuAppealLink",".j_appealLink",function(){$.stats.track("balvAppealLink","uegCount","bawuAppeal","click")}),$(".userlike_blacked").bind("mouseover",function(){e.show_black_tip($(this))}),$(".userlike_prisoned").bind("mouseover",function(){e.daysTofree>0&&e.daysTofree<360?e.show_shortblock_tip($(this),e.daysTofree,e.isBySys?"\u7CFB\u7EDF":"\u5427\u4E3B",e.isBySys?"system":"bawu"):e.show_block_tip($(this))}),$("body").delegate(".tbmall_tip_close","click",function(){return $("#tbmall_tip_card").remove(),e.tbmallTip=null,$.cookie("close_tbmall_tip","1",{expires:365}),!1}),$("#j_tcharge_dialog").on("click",function(){e.use("pcommon/widget/tcharge_dialog")}),(this.user.balv&&this.user.balv.has_liked||this.user.is_like)&&(PageData.is_ipad?$("a.p_balv_btnmanager").show():$(".balv_mod").hover(function(){$(".p_balv_btnmanager").show()},function(){$(".p_balv_btnmanager").hide()}))},dolikeEvent:function(){var e=this;$(".balv_dolike_comforum,.balv_dolike_star").bind("click",function(){return e.user.is_login?e.user.balv&&e.user.balv.is_block||e.user.forbidden&&e.user.forbidden.isForbid?e.showAlert(e.BanLib.render("balvLike")):e.user.balv&&e.user.balv.is_black||e.user.is_black?e.showAlert("\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u672C\u5427\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C"):e.dolike():_.Module.use("pcommon/widget/LoginDialog",["","ilike"]),!1})},showAlert:function(e){var i='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+e+"</div>";$.dialog.open(i,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},howtojoin:function(){$.dialog.alert("<div style='padding:20px;line-height:30px;padding-bottom:0px;'>\u70B9\u51FB\u53F3\u4FA7\u4E0A\u65B9\u201C<img align='absmiddle' src='"+PageData.staticDomain+"tb/static-member/img/whatlevel.png'></img>\u201D<br/>\u5373\u53EF\u52A0\u5165\u672C\u5427\uFF0C\u70B9\u4EAE\u5934\u8854\uFF0C\u4ECE\u521D\u7EA7\u7C89\u4E1D\u5F00\u59CB\u6210\u957F\uFF01</div>",{title:"\u5982\u4F55\u52A0\u5165",width:325})},dolike:function(){var e=this;if(this.user.is_login&&this.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u5173\u6CE8\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var i={fid:this.forum.forum_id,fname:this.forum.forum_name,uid:this.user.name_url,ie:"gbk",tbs:PageData.tbs};$.post(this.config.url.dolike,i,function(i){if(i&&0==i.no)_.Module.use("puser/widget/LikeTip",["",!1,{index:i.data.ret.index,like_no:i.like_no}]);else{var t="";t=8==i.no||9==i.no?e.BanLib.render("balvLike"):220==i.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==i.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",e.showAlert(t)}},"json")},undolike:function(){var e={fid:this.forum.forum_id,fname:this.forum.name_url,uid:this.user.name_url,ie:"utf-8",tbs:PageData.tbs};$.tb.post(this.config.url.undolike,e,function(e){e&&0==e.no&&$.tb.location.reload(!0)})},show_shortblock_tip:function(e){this.block_render(e,this.BanLib.render("balvAside"))},show_block_tip:function(e){this.block_render(e,this.BanLib.render("balvAside"))},show_black_tip:function(e){var i=new Array;i.push("<div style='width:180px;text-align:left;margin:6px 0px 6px 10px;'>"),i.push("<span>\u4F60\u5DF2\u88AB\u5427\u4E3B\u62C9\u5165\u9ED1\u540D\u5355\uFF0C</span></br><span>\u4F60\u5728\u672C\u5427\u7684\u5934\u8854\u548C\u6743\u9650\u4E5F\u88AB\u6536\u56DE\u3002</span>"),i.push("</div>"),this.block_render(e,i.join(""))},show_lvup_tip:function(e,i){var t=this,o=new Array;if(o.push("<div class='lvup_tip_container'>"),o.push("<div class='lvlup_con_msg'>\u5347\u7EA7\u5566!\u4F60\u5DF2\u62E5\u6709\u672C\u5427"+e+"\u7EA7\u5934\u8854!</div>"),o.push('<div class="lvlup_pop_rights">'+i+"</div>"),"\u52A0\u6CB9~\u7EE7\u7EED\u6512\u7ECF\u9A8C\uFF01"==i)o.push("<a style='float:left;' href='/f/like/level?kw="+this.forum.name_url+"' target='_blank'>\u67E5\u770B\u5347\u7EA7\u79D8\u7B08</a>");else{var s='Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=balvupguide&lv='+e+'")';o.push("<a href='#sub' style='float:left;' onclick='rich_postor.jumpToTry("+e+");"+s+"'>\u73B0\u5728\u53BB\u8BD5\u8BD5~~</a>")}o.push("</div>");var l=o.join(""),n={content:l,arrow_dir:"up",bubble_css:{top:4,right:-5,width:232,"z-index":9999},arrow_pos:{left:209},attr:"lvup_tip_table",wrap:$("#userlike_info_tip"),closeBtn:!0},r=new UiBubbleTipBase(n);r.j_bubble.find(".j_content").css("padding","2px").addClass("lvup_tip_table"),r.showBubble(),r.bind("onclose",function(){t.close_lvup_tip()},!0),this.user.is_block||setTimeout(function(){r.closeBubble(),t.close_lvup_tip()},8e3)},block_render:function(e,i){if(!this.block_bubble){var t=this,o={content:i,arrow_dir:"up",bubble_css:{top:36,right:4,width:232,"z-index":9999},arrow_pos:{left:209},attr:"",wrap:e,closeBtn:!0};this.block_bubble=new UiBubbleTipBase(o),this.block_bubble.j_bubble.find(".j_content").css("padding","2px"),this.block_bubble.showBubble(),this.block_bubble.bind("onclose",function(){t.block_bubble.closeBubble(),t.block_bubble=null});{setTimeout(function(){t.block_bubble&&(t.block_bubble.closeBubble(),t.block_bubble=null)},5e3)}}},close_lvup_tip:function(){var e={fid:this.forum.forum_id,fname:this.forum.name_url,uid:this.user.name_url,ie:"utf-8",tbs:PageData.tbs,type:2};$.tb.post(this.config.url.closetip,e,function(e){e&&0==e.no})},show_orange_tip:function(){if("false"!=$.cookie("close_sign_tip_o")){$.cookie("close_sign_tip_o",!0,{expires:14});var e={content:"\u8FDE\u7EED\u7B7E\u523030\u5929ID\u5373\u53EF\u9AD8\u4EAE\u5C55\u793A\uFF0C\u4E00\u8D77\u95EA\u8000\u5427\uFF01",arrow_dir:"down",bubble_css:{top:3,right:25,width:145,"z-index":9999},arrow_pos:{left:88},attr:" ",wrap:$(".user_profile .user_name"),closeBtn:!0},i=new UiBubbleTipBase(e);i.j_bubble.find(".j_body").css("padding-right","3px"),i.showBubble(),i.bind("onclose",function(){$.cookie("close_sign_tip_o",!1,{expires:14})},!0);{setTimeout(function(){$(".j_wrap .j_close").click()},8e3)}}},showNewpropsTip:function(){var e=$.cookie("NEWS_PROPS_NOTICE"),i=this.user.global&&this.user.global.tbmall_newprops||"";(!e&&i>0||e&&i>e)&&this.buildNewpropsTip()},buildNewpropsTip:function(){var e=this,i={content:'<a class="j_newprops_tip" href="/tbmall/home?sn=1" target="_blank" style="text-align:center;display:block;">\u6709\u65B0\u9053\u5177\u4E0A\u7EBF\u54E6~</a>',arrow_dir:"up",arrow_pos:{left:40},bubble_css:{top:-35,left:100,width:100},wrap:$("#j_profile_pop"),closeBtn:!0},t=new UiBubbleTipBase(i),o="";t.bind("onclose",function(){t.closeBubble(),o=e.user.global&&e.user.global.tbmall_newprops||"",$.cookie("NEWS_PROPS_NOTICE",o,{expires:30,path:"/"})}),t.showBubble(),t.j_bubble.find(".j_newprops_tip").on("click",function(){$.post("/tbmall/post/addpropstoucenter",null,function(){}),t.closeBubble(),o=e.user.global&&e.user.global.tbmall_newprops||"",$.cookie("NEWS_PROPS_NOTICE",o,{expires:30,path:"/"})})},hasLevel:function(){var e=Math.floor((new Date).getTime()/1e3);return this.user.Parr_props&&this.user.Parr_props.level&&this.user.Parr_props.level.end_time>e}}});